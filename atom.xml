<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¤§è„‘å¥½é¥¿</title>
  
  <subtitle>è¡¥å……å¤§è„‘è¥å…»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.imliujun.com/"/>
  <updated>2018-03-21T16:32:10.000Z</updated>
  <id>http://www.imliujun.com/</id>
  
  <author>
    <name>LiuJun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>çº¿ç¨‹å®‰å…¨å¼•èµ·çš„å½•éŸ³æ‚éŸ³ç”µæµéŸ³é—®é¢˜</title>
    <link href="http://www.imliujun.com/recording1.html"/>
    <id>http://www.imliujun.com/recording1.html</id>
    <published>2018-03-21T16:29:24.000Z</published>
    <updated>2018-03-21T16:32:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´å†™äº†ä¸€ä¸ªå½•éŸ³æ¨¡å—ï¼Œéœ€æ±‚æ˜¯ï¼šã€å½•éŸ³çš„æ—¶å€™å®æ—¶è¯­éŸ³è½¬æ–‡å­—ï¼Œå®æ—¶è®¡ç®—éŸ³é‡å¤§å°ï¼Œå®æ—¶è¿›è¡Œ MP3 è½¬ç ä¿å­˜ä¸ºæ–‡ä»¶ã€</p><p>é¦–å…ˆè¿›è¡Œéœ€æ±‚åˆ†æï¼Œç¡®å®šæŠ€æœ¯æ–¹æ¡ˆï¼š</p><ol><li>ä½¿ç”¨ AudioRecord è¿›è¡Œå½•éŸ³ï¼Œå®æ—¶è·å–åŸå§‹éŸ³é¢‘æ•°æ®</li><li>å°†éŸ³é¢‘æ•°æ®ä¼ é€’ç»™ç¬¬ä¸‰æ–¹è¯­éŸ³è½¬æ–‡å­— SDK è¿›è¡Œå¤„ç†</li><li>å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè®¡ç®—å‡ºéŸ³é‡å¤§å°</li><li>å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œ MP3 ç¼–ç </li><li>å°†ç¼–ç åçš„æ•°æ®å†™å…¥ MP3 æ–‡ä»¶</li></ol><p>æ•´ä¸ªä¸šåŠ¡æµç¨‹å¦‚ä¸Šï¼Œåªä¸è¿‡æˆ‘ä»¬ä¸ºäº†æ•ˆç‡å’Œè§£è€¦ï¼Œå°†æ¯ä¸ªå¤„ç†é€»è¾‘ç‹¬ç«‹å¼€æ¥ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶å‘å¤„ç†ã€‚</p><p>å…·ä½“æµç¨‹è§ä¸‹å›¾ï¼š</p><img title="å½•éŸ³æµç¨‹å›¾" src="http://images.imliujun.com/static/images/Recording/RecordingFlowChart.jpeg"><h2 id="ä»£ç æ’¸èµ·æ¥"><a href="#ä»£ç æ’¸èµ·æ¥" class="headerlink" title="ä»£ç æ’¸èµ·æ¥"></a>ä»£ç æ’¸èµ·æ¥</h2><p>ä¸‹é¢çš„ä¼ªä»£ç å…¨éƒ¨ä½¿ç”¨ <code>kotlin</code> å±•ç¤ºï¼Œä¸ç†Ÿæ‚‰ <code>kotlin</code> æ²¡å…³ç³»ï¼Œåªéœ€è¦å…³æ³¨å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><h3 id="éŸ³é¢‘æ•°æ®é‡‡é›†"><a href="#éŸ³é¢‘æ•°æ®é‡‡é›†" class="headerlink" title="éŸ³é¢‘æ•°æ®é‡‡é›†"></a>éŸ³é¢‘æ•°æ®é‡‡é›†</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»™ AudioRecord è¿›è¡Œå½•éŸ³é‡‡é›†ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> emitter: FlowableProcessor&lt;ShortArray&gt;</span><br><span class="line"><span class="keyword">val</span> isRecording = AtomicBoolean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = ShortArray(bufferSize)</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°†æ•°æ®ä½¿ç”¨ RxJava å‘é€å‡ºå»</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­è¯»å–åˆ°éŸ³é¢‘æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ RxJava å°†æ•°æ®å‘ä¸‹ä¼ é€’ã€‚<strong>ï¼ˆç”¨ä»€ä¹ˆä¼ é€’ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å°†æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€å±‚å»è¿›è¡Œå¤„ç†ï¼‰</strong></p><h3 id="å¯¹æ•°æ®è¿›è¡Œå¤„ç†"><a href="#å¯¹æ•°æ®è¿›è¡Œå¤„ç†" class="headerlink" title="å¯¹æ•°æ®è¿›è¡Œå¤„ç†"></a>å¯¹æ•°æ®è¿›è¡Œå¤„ç†</h3><p>å¤–éƒ¨æ¥æ”¶ RxJava çš„äº‹ä»¶ï¼Œå¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå¤„ç† <strong>ï¼ˆå†æ¬¡æé†’ï¼Œä¸éœ€è¦åœ¨æ„ç»†èŠ‚ï¼Œä¸»è¦å…³æ³¨ä¸šåŠ¡æµç¨‹ï¼‰</strong> ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ observeOnIo() æ“ä½œå°†çº¿ç¨‹åˆ‡æ¢åˆ° IO çº¿ç¨‹</span></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¡ç®—éŸ³é‡å¤§å°</span></span><br><span class="line">  <span class="keyword">val</span> volume = calVolume(it)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å°† ShortArray è½¬æ¢ä¸º ByteArray</span></span><br><span class="line">  <span class="keyword">var</span> pcmBuffer: ByteArray = ...</span><br><span class="line">  it.toByteArray(pcmBuffer)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¯­éŸ³è½¬æ–‡å­—</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿›è¡Œ MP3 ç¼–ç </span></span><br><span class="line">  <span class="keyword">val</span> encode = mp3Encode(it)</span><br><span class="line">  <span class="keyword">if</span> (encode != <span class="literal">null</span> &amp;&amp; encode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// å°†ç¼–ç åçš„æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    mp3Stream.write(mp3Buffer, <span class="number">0</span>, encode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªä¸šåŠ¡æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œæˆ‘è‡ªå·±ä½¿ç”¨çš„æ‰‹æœºå’Œå…¬å¸æ‰€æœ‰çš„æµ‹è¯•æœºï¼Œè¯•å¬å½•åˆ¶å‡ºæ¥çš„ MP3 æ–‡ä»¶éƒ½æ²¡æœ‰é—®é¢˜ã€‚</p><p>å¼€å¼€å¿ƒå¿ƒçš„æ‰“åŒ…ï¼Œæµ‹è¯•ï¼Œä¸Šçº¿ã€‚</p><p>ç„¶åä½ æ‡‚çš„ï¼Œæœ‰äº›ç”¨æˆ·å½•åˆ¶å‡ºç°æ‚éŸ³ã€ç”µæµéŸ³ã€å£°éŸ³æ–­æ–­ç»­ç»­ã€‚ğŸ˜‚ğŸ˜‚</p><p>æœºæ™ºçš„åŒå­¦å¯èƒ½é€šè¿‡æ ‡é¢˜å·²ç»çŒœåˆ°äº†é—®é¢˜çš„åŸå› ï¼Œä½†æˆ‘å½“æ—¶æ²¡æœ‰æ‰‹æœºè¿›è¡Œé—®é¢˜å¤ç°ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯æ˜¯èŠ±äº†å¾ˆå¤§çš„åŠŸå¤«æ‰å®šä½åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p><h3 id="è§£å†³æ‚éŸ³é—®é¢˜"><a href="#è§£å†³æ‚éŸ³é—®é¢˜" class="headerlink" title="è§£å†³æ‚éŸ³é—®é¢˜"></a>è§£å†³æ‚éŸ³é—®é¢˜</h3><p>å› ä¸ºæˆ‘ä»¬åœ¨å½•éŸ³é‡‡é›†æ—¶å°†æ•°æ®è¯»å–åˆ° <code>buffer</code> å¯¹è±¡ä¸­ï¼Œç„¶åå°† <code>buffer</code> å¯¹è±¡é€šè¿‡ RxJava å‘ä¸‹ä¼ é€’ï¼Œå› ä¸º RxJava çš„ä¸‹æ¸¸éƒ½å¼€å¯äº†å¼‚æ­¥çº¿ç¨‹å»å¤„ç†äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨å½•éŸ³é‡‡é›†çš„æ­»å¾ªç¯ä¸­ä¸ç­‰å½“å‰çš„æ•°æ®è¿›è¡Œ MP3 ç¼–ç å®Œæ¯•å°±å¯¹ <code>buffer</code> å¯¹è±¡å†™å…¥æ–°é‡‡é›†åˆ°çš„éŸ³é¢‘æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ MP3 ç¼–ç å‡ºæ¥çš„éŸ³é¢‘æ•°æ®å°±è¢«æ±¡æŸ“äº†ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> emitter: FlowableProcessor&lt;ShortArray&gt;</span><br><span class="line"><span class="keyword">val</span> isRecording = AtomicBoolean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = ShortArray(bufferSize)</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="comment">// è¯»å–éŸ³é¢‘æ•°æ®åˆ° buffer ä¸­</span></span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°† buffer å‘é€å‡ºå»ï¼Œå› ä¸ºä¸‹æ¸¸æ˜¯å¼‚æ­¥å¤„ç†ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œæ¯•ç›´æ¥å¼€å§‹ä¸‹æ¬¡å¾ªç¯</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°† buffer æ•°æ® copy ä¸€ä»½è¿›è¡Œä¼ é€’ï¼Œè¿™æ ·å°±ä¸ä¼šä¿®æ”¹ä¸‹æ¸¸çš„æ•°æ®äº†</span></span><br><span class="line">emitter.onNext(buffer.copyOf())</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨ copy çš„æ–¹å¼ä¼šé¢‘ç¹çš„åˆ›å»ºã€é”€æ¯ ShortArray å¯¹è±¡ï¼Œèƒ½ä¸èƒ½ä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯¹è±¡æ± æ¥ç®¡ç† ShortArrayï¼Œè¿™æ ·å°±ä¸ä¼šé¢‘ç¹çš„è¿›è¡Œåˆ›å»ºã€é”€æ¯æ“ä½œã€‚åœ¨ Android çš„ support.v4 åŒ…ä¸­æœ‰ä¸€ä¸ª <code>Pools</code> ç±»å®ç°äº†ç®€å•çš„å¯¹è±¡æ± åŠŸèƒ½ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bufferPool = Pools.SynchronizedPool&lt;ShortArray&gt;(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">acquireBuffer</span><span class="params">(bufferSize: <span class="type">Int</span>)</span></span>: ShortArray &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = bufferPool.acquire()</span><br><span class="line">  <span class="keyword">if</span> (buffer == <span class="literal">null</span> || buffer.size != bufferSize) &#123;</span><br><span class="line">    buffer = ShortArray(bufferSize)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> buffer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">releaseBuffer</span><span class="params">(shortArray: <span class="type">ShortArray</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    bufferPool.release(shortArray)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">    Timber.e(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡å¯¹è±¡æ± è·å– buffer å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">val</span> buffer = acquireBuffer(bufferSize)</span><br><span class="line">    <span class="comment">// è¯»å–éŸ³é¢‘æ•°æ®åˆ° buffer ä¸­</span></span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°† buffer å‘é€å‡ºå»ï¼Œä¸‹æ¸¸å¤„ç†å®Œæ¯•åè°ƒç”¨ releaseBuffer å¯¹ buffer å¯¹è±¡è¿›è¡Œé‡Šæ”¾</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾ˆç®€å•çš„ä¸€ä¸ªå¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è‡ªå·±ä¸èƒ½å¤ç°çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¸¦æ¥äº†å¾ˆå¤§çš„éº»çƒ¦ã€‚<br>è¿™ç§é—®é¢˜åœ¨ç¼–å†™ <code>emitter.onNext(buffer)</code> è¿™è¡Œä»£ç çš„æ—¶å€™å°±åº”è¯¥è¦è€ƒè™‘åˆ°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä¹‹å‰åšç›´æ’­æˆªå±çš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆªå–ç›´æ’­æµçš„ç”»é¢å¸§ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œå› ä¸ºæˆªå±çš„æ“ä½œä¸ä¼šå¾ˆé¢‘ç¹ï¼Œå½“æ—¶æ˜¯ç›´æ¥ copy ä¸€ä»½ç”»é¢å¸§çš„æ•°æ®ä¿å­˜ä¸ºå›¾ç‰‡ã€‚</p><p>å¯æ˜¯ä»¥å‰æ²¡æœ‰å†™åšå®¢è®°å½•è¿™ç§å°é—®é¢˜ï¼Œå¯¼è‡´é‡åˆ°ç±»ä¼¼çš„é—®é¢˜å°½é‡ä¸è®°å¾—äº†ã€‚æ‰€ä»¥è¿™æ¬¡è®°å½•ä¸‹æ¥ğŸ˜‚ğŸ˜‚ã€‚</p><p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img title="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿" src="http://images.imliujun.com/static/images/wx_qrcode.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰æ®µæ—¶é—´å†™äº†ä¸€ä¸ªå½•éŸ³æ¨¡å—ï¼Œéœ€æ±‚æ˜¯ï¼šã€å½•éŸ³çš„æ—¶å€™å®æ—¶è¯­éŸ³è½¬æ–‡å­—ï¼Œå®æ—¶è®¡ç®—éŸ³é‡å¤§å°ï¼Œå®æ—¶è¿›è¡Œ MP3 è½¬ç ä¿å­˜ä¸ºæ–‡ä»¶ã€&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¿›è¡Œéœ€æ±‚åˆ†æï¼Œç¡®å®šæŠ€æœ¯æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ AudioRecord è¿›è¡Œå½•éŸ³ï¼Œå®æ—¶è·å–åŸå§‹éŸ³é¢‘æ•°æ®&lt;/li&gt;
&lt;li&gt;å°†éŸ³
      
    
    </summary>
    
      <category term="Android" scheme="http://www.imliujun.com/categories/Android/"/>
    
    
      <category term="å½•éŸ³" scheme="http://www.imliujun.com/tags/%E5%BD%95%E9%9F%B3/"/>
    
      <category term="AudioRecord" scheme="http://www.imliujun.com/tags/AudioRecord/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Gradle å®ç°ä¸€å¥—ä»£ç å¼€å‘å¤šä¸ªåº”ç”¨</title>
    <link href="http://www.imliujun.com/gradle3.html"/>
    <id>http://www.imliujun.com/gradle3.html</id>
    <published>2017-07-11T07:06:23.000Z</published>
    <updated>2018-03-09T04:51:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ–‡ç«  <a href="http://www.imliujun.com/gradle1.html">ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</a> ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé’ˆå¯¹ä¸€ä¸ªåº”ç”¨çš„æ­£å¼æœã€æµ‹è¯•æœã€è¶…ç®¡æœç­‰å…¶ä»–ç‰ˆæœ¬ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚<br>è¿™ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬æ¥ç‚¹å¤§åŠ¨ä½œï¼Œè®©ä½ ç”¨ä¸€å¥—ä»£ç æ„å»ºå¤šä¸ªåº”ç”¨ã€‚</p><h1 id="åœºæ™¯ä»‹ç»"><a href="#åœºæ™¯ä»‹ç»" class="headerlink" title="åœºæ™¯ä»‹ç»"></a>åœºæ™¯ä»‹ç»</h1><p>éœ€æ±‚ï¼šâ€œå°†æŸä¸ªåº”ç”¨æ¢ä¸€å¥—çš®è‚¤ã€ç¬¬ä¸‰æ–¹è´¦å·ã€åå°æœåŠ¡å™¨ï¼Œæ”¹ä¸ªåå­—ä¸Šçº¿ï¼Œå¹¶ä¸”ä»¥åçš„æ–°åŠŸèƒ½åŒæ­¥è¿›è¡Œæ›´æ–°â€ã€‚</p><p>å½“ä½ é‡åˆ°è¿™æ ·çš„éœ€æ±‚ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>æ˜¯å°†é¡¹ç›®å¤åˆ¶ä¸€ä»½ï¼Œç„¶åä¿®æ”¹å…¶ä¸­çš„å†…å®¹ï¼Œæœ‰æ–°åŠŸèƒ½çš„æ—¶å€™å†æ‰‹åŠ¨å¤åˆ¶è¿‡æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ UIï¼Ÿ</p><p>æˆ–è€…å¯ä»¥åˆ‡æ¢ä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šä¿®æ”¹ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯æ¬¡å¼€å‘å®Œæ–°åŠŸèƒ½ï¼Œå°†ä»£ç åˆå¹¶è¿‡æ¥ï¼Œå†ç¨å¾®ä¿®æ”¹æ–°åŠŸèƒ½çš„ UIï¼Ÿ</p><p>ç°åœ¨æˆ‘æ¥ä»‹ç»ä½¿ç”¨ <code>Gradle</code> çš„ <code>flavorDimensions</code>ï¼Œå®ç°ä¸€ä»½ä»£ç æ„å»ºå¤šä¸ªåº”ç”¨ã€‚</p><h1 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h1><p>è€è§„çŸ©ï¼Œå…ˆä¸Šå®Œæ•´çš„ <code>Gradle</code> é…ç½®ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">25</span></span><br><span class="line">    buildToolsVersion <span class="string">"25.0.3"</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion <span class="number">16</span></span><br><span class="line">        targetSdkVersion <span class="number">25</span></span><br><span class="line">        versionCode gitVersionCode()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®ä¸¤ä¸ªåº”ç”¨çš„ç­¾åæ–‡ä»¶</span></span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        app1 &#123;</span><br><span class="line">            storeFile <span class="keyword">file</span>(<span class="string">"app1.jks"</span>)</span><br><span class="line">            storePassword <span class="string">"111111"</span></span><br><span class="line">            keyAlias <span class="string">"app1"</span></span><br><span class="line">            keyPassword <span class="string">"111111"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        app2 &#123;</span><br><span class="line">            storeFile <span class="keyword">file</span>(<span class="string">"app2.jks"</span>)</span><br><span class="line">            storePassword <span class="string">"111111"</span></span><br><span class="line">            keyAlias <span class="string">"app2"</span></span><br><span class="line">            keyPassword <span class="string">"111111"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">// ä¸æ˜¾ç¤ºLog</span></span><br><span class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"false"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            <span class="comment">// æ˜¾ç¤ºLog</span></span><br><span class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"true"</span></span><br><span class="line">            versionNameSuffix <span class="string">"-debug"</span></span><br><span class="line">            signingConfig <span class="keyword">null</span></span><br><span class="line">            manifestPlaceholders.UMENG_CHANNEL_VALUE = <span class="string">"test"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸¤ä¸ªç»´åº¦çš„ flavor</span></span><br><span class="line">    flavorDimensions <span class="string">"APP"</span>, <span class="string">"SERVER"</span></span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line"></span><br><span class="line">        app1 &#123;</span><br><span class="line">            dimension <span class="string">"APP"</span></span><br><span class="line">            applicationId <span class="string">'com.imliujun.app1'</span></span><br><span class="line"></span><br><span class="line">            versionName rootProject.ext.APP1_versionName</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åº”ç”¨å</span></span><br><span class="line">            resValue <span class="string">"string"</span>, <span class="string">"app_name"</span>, <span class="string">"APP1"</span></span><br><span class="line"></span><br><span class="line">            buildConfigField(<span class="string">"String"</span>, <span class="string">"versionNumber"</span>, <span class="string">"\"$&#123;rootProject.ext.APP1_versionName&#125;\""</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ç¬¬ä¸‰æ–¹SDKçš„ä¸€äº›é…ç½®</span></span><br><span class="line">            buildConfigField <span class="string">"int"</span>, <span class="string">"IM_APPID"</span>, <span class="string">"app1çš„è…¾è®¯IM APPID"</span></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"IM_ACCOUNTTYPE"</span>, <span class="string">"\"app1çš„è…¾è®¯IM accountype\""</span></span><br><span class="line">            manifestPlaceholders = [UMENG_APP_KEY      : <span class="string">"app1çš„å‹ç›Ÿ APP KEY"</span>,</span><br><span class="line">                                    UMENG_CHANNEL_VALUE: <span class="string">"app1é»˜è®¤çš„æ¸ é“å"</span>,</span><br><span class="line">                                    XG_ACCESS_ID       : <span class="string">"app1ä¿¡é¸½æ¨é€ACCESS_ID"</span>,</span><br><span class="line">                                    XG_ACCESS_KEY      : <span class="string">"app1ä¿¡é¸½æ¨é€ACCESS_KEY"</span>,</span><br><span class="line">                                    QQ_APP_ID          : <span class="string">"app1çš„QQ_APP_ID"</span>,</span><br><span class="line">                                    AMAP_KEY           : <span class="string">"app1çš„é«˜å¾·åœ°å›¾key"</span>,</span><br><span class="line">                                    APPLICATIONID      : applicationId]</span><br><span class="line">            <span class="comment">//ç­¾åæ–‡ä»¶</span></span><br><span class="line">            signingConfig signingConfigs.app1</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        app2 &#123;</span><br><span class="line">            dimension <span class="string">"APP"</span></span><br><span class="line">            applicationId <span class="string">'com.imliujun.app2'</span></span><br><span class="line"></span><br><span class="line">            versionName rootProject.ext.APP2_versionName</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åº”ç”¨å</span></span><br><span class="line">            resValue <span class="string">"string"</span>, <span class="string">"app_name"</span>, <span class="string">"APP2"</span></span><br><span class="line"></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"versionNumber"</span>, <span class="string">"\"$&#123;rootProject.ext.APP2_versionName&#125;\""</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//ç¬¬ä¸‰æ–¹SDKçš„ä¸€äº›é…ç½®</span></span><br><span class="line">            buildConfigField <span class="string">"int"</span>, <span class="string">"IM_APPID"</span>, <span class="string">"app2çš„è…¾è®¯IM APPID"</span></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"IM_ACCOUNTTYPE"</span>, <span class="string">"\"app2çš„è…¾è®¯IM accountype\""</span></span><br><span class="line">            manifestPlaceholders = [UMENG_APP_KEY      : <span class="string">"app2çš„å‹ç›Ÿ APP KEY"</span>,</span><br><span class="line">                                    UMENG_CHANNEL_VALUE: <span class="string">"app2é»˜è®¤çš„æ¸ é“å"</span>,</span><br><span class="line">                                    XG_ACCESS_ID       : <span class="string">"app2ä¿¡é¸½æ¨é€ACCESS_ID"</span>,</span><br><span class="line">                                    XG_ACCESS_KEY      : <span class="string">"app2ä¿¡é¸½æ¨é€ACCESS_KEY"</span>,</span><br><span class="line">                                    QQ_APP_ID          : <span class="string">"app2çš„QQ_APP_ID"</span>,</span><br><span class="line">                                    AMAP_KEY           : <span class="string">"app2çš„é«˜å¾·åœ°å›¾key"</span>,</span><br><span class="line">                                    APPLICATIONID      : applicationId]</span><br><span class="line">            <span class="comment">//ç­¾åæ–‡ä»¶</span></span><br><span class="line">            signingConfig signingConfigs.app2</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        offline &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span></span><br><span class="line"></span><br><span class="line">            versionName getTestVersionName()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        online &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        admin &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span></span><br><span class="line"></span><br><span class="line">            versionName rootProject.ext.versionName + <span class="string">"-ç®¡ç†å‘˜"</span></span><br><span class="line">            manifestPlaceholders.UMENG_CHANNEL_VALUE = <span class="string">"admin"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    <span class="keyword">switch</span> (variant.flavorName) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Admin"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://admin.app1domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getTestVersionName() + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(rootProject.ext.APP1_VERSION_NAME + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Offline"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://offline.app1domain.com/\""</span></span><br><span class="line">            variant.mergedFlavor.setVersionName(getTestVersionName())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Online"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://online.app1domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getTestVersionName())</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Admin"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://admin.app2domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getApp2TestVersionName() + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(rootProject.ext.APP2_VERSION_NAME + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Offline"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://offline.app2domain.com/\""</span></span><br><span class="line">            variant.mergedFlavor.setVersionName(getApp2TestVersionName())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Online"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://online.app2domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getApp2TestVersionName())</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">    APP1_VERSION_NAME = <span class="string">"2.0.2"</span></span><br><span class="line">    APP1_TEST_NUM = <span class="string">"0001"</span></span><br><span class="line">    APP2_VERSION_NAME = <span class="string">"1.0.5"</span></span><br><span class="line">    APP2_TEST_NUM = <span class="string">"0005"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getTestVersionName() &#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"%s.%s"</span>, rootProject.ext.APP1_VERSION_NAME,</span><br><span class="line">            rootProject.ext.APP1_TEST_NUM)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getApp2TestVersionName() &#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"%s.%s"</span>, rootProject.ext.APP2_VERSION_NAME,</span><br><span class="line">            rootProject.ext.APP2_TEST_NUM)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> gitVersionCode() &#123;</span><br><span class="line">    <span class="keyword">def</span> <span class="keyword">count</span> = <span class="string">"git rev-list HEAD --count"</span>.execute().text.trim()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">count</span>.isInteger() ? <span class="keyword">count</span>.<span class="keyword">toInteger</span>() : <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„é…ç½®ä¸Šè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼ŒåŒæ—¶ä¿ç•™ä¸Šä¸€ç¯‡æ–‡ç« é‡Œæ‰€æœ‰çš„åŠŸèƒ½ã€‚</p><h2 id="é…ç½®å¤šåº”ç”¨"><a href="#é…ç½®å¤šåº”ç”¨" class="headerlink" title="é…ç½®å¤šåº”ç”¨"></a>é…ç½®å¤šåº”ç”¨</h2><p>é¦–å…ˆæ¥çœ‹æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flavorDimensions <span class="string">"APP"</span>, <span class="string">"SERVER"</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œä»£ç é…ç½®äº†ä¸¤ä¸ªç»´åº¦çš„ <code>flavor</code>ï¼Œ<code>APP</code> ä»£è¡¨å¤šåº”ç”¨ï¼Œ<code>SERVER</code> ä»£è¡¨æœåŠ¡å™¨ç‰ˆæœ¬ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„é…ç½®ä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œ<code>app1</code>ã€<code>app2</code> è®¾ç½®äº† <code>dimension &quot;APP&quot;</code> æ‰€ä»¥å±äº <code>APP</code> è¿™ä¸ªç»´åº¦ï¼Œ<code>offline</code>ã€<code>online</code>ã€<code>admin</code> è®¾ç½®äº† <code>dimension &quot;SERVER&quot;</code> å±äº <code>SERVER</code> è¿™ä¸ªç»´åº¦ã€‚</p><p>æ ¹æ® Product Flavors çš„ä¸¤ä¸ªç»´åº¦ APP [app1, app2] å’Œ SERVER [offline, online, admin] ä»¥åŠ Build Type [debug, release]ï¼Œæœ€åä¼šç”Ÿæˆä»¥ä¸‹ Build Variantï¼š</p><ul><li><code>app1AdminDebug</code></li><li><code>app1AdminRelease</code></li><li><code>app1OfflineDebug</code></li><li><code>app1OfflineRelease</code></li><li><code>app1OnlineDebug</code></li><li><code>app1OnlineRelease</code></li><li><code>app2AdminDebug</code></li><li><code>app2AdminRelease</code></li><li><code>app2OfflineDebug</code></li><li><code>app2OfflineRelease</code></li><li><code>app2OnlineDebug</code></li><li><code>app2OnlineRelease</code></li></ul><p>æ˜¯ä¸æ˜¯æ¯ä¸ªåº”ç”¨éƒ½æœ‰ 3 ä¸ªæœåŠ¡å™¨ç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ <code>debug</code> å’Œ <code>release</code> åŒ…ã€‚</p><h2 id="é…ç½®ä¸åŒçš„åŒ…å"><a href="#é…ç½®ä¸åŒçš„åŒ…å" class="headerlink" title="é…ç½®ä¸åŒçš„åŒ…å"></a>é…ç½®ä¸åŒçš„åŒ…å</h2><p>æˆ‘ä»¬è¦å®ç°å¤šåº”ç”¨ï¼Œå¿…é¡»èƒ½å®‰è£…åœ¨åŒä¸€å°æ‰‹æœºä¸Šã€‚æ‰€ä»¥ä¸åŒåº”ç”¨ä¹‹é—´çš„åŒ…åå¾—ä¸ä¸€æ ·ã€‚</p><p>åœ¨ <code>APP</code> ç»´åº¦çš„ <code>flavor</code> ä¸­è®¾ç½®ä¸åŒçš„ <code>applicationId</code>ï¼Œå°±å¯ä»¥å®ç°ä¿®æ”¹åº”ç”¨åŒ…åã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app1&#123;</span><br><span class="line">    applicationId <span class="string">'com.imliujun.app1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app2&#123;</span><br><span class="line">    applicationId <span class="string">'com.imliujun.app2'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®åï¼Œ<code>app1</code> å’Œ <code>app2</code> å°±èƒ½å¤Ÿå®‰è£…åœ¨åŒä¸€å°æ‰‹æœºä¸Šï¼Œä¹Ÿèƒ½åŒæ—¶ä¸Šä¼ åº”ç”¨å•†åº—ã€‚</p><p>æœ‰ä¸€ç‚¹å¤§å®¶åˆ‡è®°ï¼Œ<code>AndroidManifest.xml</code> ä¸­çš„ <code>package</code> ä¸éœ€è¦å»ä¿®æ”¹ï¼ŒR æ–‡ä»¶çš„è·¯å¾„æ˜¯æ ¹æ®è¿™ä¸ª <code>package</code> æ¥ç”Ÿæˆçš„ã€‚å¦‚æœå¯¹ <code>package</code> è¿›è¡Œä¿®æ”¹ï¼ŒR æ–‡ä»¶çš„è·¯å¾„ä¹Ÿä¼šæ”¹å˜ï¼Œæ‰€æœ‰å¼•ç”¨åˆ° R æ–‡ä»¶çš„ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="åŠ¨æ€é…ç½®-URL-å’Œç‰ˆæœ¬å·"><a href="#åŠ¨æ€é…ç½®-URL-å’Œç‰ˆæœ¬å·" class="headerlink" title="åŠ¨æ€é…ç½® URL å’Œç‰ˆæœ¬å·"></a>åŠ¨æ€é…ç½® URL å’Œç‰ˆæœ¬å·</h2><p>æ—¢ç„¶æ¯ä¸ª Build Variant éƒ½æ˜¯ç”±ä¸åŒç»´åº¦çš„ Product Flavors å’Œ Build Type ç»„åˆè€Œæ¥ï¼Œæˆ‘ä»¬è‚¯å®šä¸èƒ½åƒä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·å°†æœåŠ¡å™¨çš„ URL é…ç½®åœ¨ <code>offline</code>ã€<code>online</code>ã€<code>admin</code> ä¸­äº†ï¼Œå› ä¸º <code>app1Offline</code> å’Œ <code>app2Offline</code> åŒæ ·æ˜¯æµ‹è¯•æœï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªåº”ç”¨ URL ä¹Ÿä¸ä¸€æ ·ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡ task æ“ä½œæ¥æ ¹æ®ä¸åŒçš„ç»„åˆè®¾ç½®ä¸åŒçš„æ•°æ®äº†ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰çš„ flavorName æ˜¯ä»€ä¹ˆç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">switch</span> (variant.flavorName) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Admin"</span>:</span><br><span class="line">            <span class="comment">//è¿™æ˜¯ app1 çš„è¶…ç®¡ç‰ˆæœ¬ï¼Œè®¾ç½®è¶…ç®¡æœåŠ¡å™¨ URL</span></span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://admin.app1domain.com/\""</span></span><br><span class="line">            <span class="comment">//åˆ¤æ–­å½“å‰æ˜¯ `debug` åŒ…è¿˜æ˜¯ `release` åŒ…ï¼Œè®¾ç½®ç‰ˆæœ¬å·</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getTestVersionName() + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(rootProject.ext.APP1_VERSION_NAME + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Offline"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://offline.app1domain.com/\""</span></span><br><span class="line">            variant.mergedFlavor.setVersionName(getTestVersionName())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app1Online"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://online.app1domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getTestVersionName())</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Admin"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://admin.app2domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getApp2TestVersionName() + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(rootProject.ext.APP2_VERSION_NAME + <span class="string">"-ç®¡ç†å‘˜"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Offline"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://offline.app2domain.com/\""</span></span><br><span class="line">            variant.mergedFlavor.setVersionName(getApp2TestVersionName())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"app2Online"</span>:</span><br><span class="line">            variant.buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>,</span><br><span class="line">                    <span class="string">"\"https://online.app2domain.com/\""</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"debug"</span> == variant.buildType.getName()) &#123;</span><br><span class="line">                variant.mergedFlavor.setVersionName(getApp2TestVersionName())</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ª APP çš„æœåŠ¡å™¨ URL å’Œç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œæ‰€ä»¥é€šè¿‡ task æ¥åŠ¨æ€è®¾ç½®ã€‚</p><h2 id="é…ç½®åº”ç”¨å"><a href="#é…ç½®åº”ç”¨å" class="headerlink" title="é…ç½®åº”ç”¨å"></a>é…ç½®åº”ç”¨å</h2><p>ä¸åŒçš„åº”ç”¨é…ç½®è‡ªå·±çš„åº”ç”¨åï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resValue <span class="string">"string"</span>, <span class="string">"app_name"</span>, <span class="string">"APP1"</span></span><br></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç çš„æ„æ€å’Œåœ¨ <code>strings.xml</code> ä¸­å®šä¹‰ä¸€ä¸ª String å€¼æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡è¿™é‡Œé€šè¿‡ Gradle é…ç½®äº† <code>app_name</code> å°±ä¸èƒ½åœ¨ <code>strings.xml</code> ä¸­å†å®šä¹‰äº†ï¼Œä¼šæŠ¥é”™æç¤ºæœ‰å†²çªã€‚</p><h2 id="é…ç½®åº”ç”¨ç­¾å"><a href="#é…ç½®åº”ç”¨ç­¾å" class="headerlink" title="é…ç½®åº”ç”¨ç­¾å"></a>é…ç½®åº”ç”¨ç­¾å</h2><p>å¦‚æœå¤šä¸ªåº”ç”¨ä½¿ç”¨åŒä¸€ä¸ªç­¾åæ–‡ä»¶ï¼ŒæŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« å†™çš„åœ¨ <code>buildTypes</code> çš„ <code>release</code> å’Œ <code>debug</code> ä¸­é…ç½®å°±å¯ä»¥ã€‚ä½†æ˜¯æ¯ä¸ªåº”ç”¨çš„ç­¾åæ–‡ä»¶ä¸ä¸€æ ·å‘¢ï¼Ÿ</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line"></span><br><span class="line">    app1 &#123;</span><br><span class="line">        storeFile <span class="keyword">file</span>(<span class="string">"app1.jks"</span>)</span><br><span class="line">        storePassword <span class="string">"111111"</span></span><br><span class="line">        keyAlias <span class="string">"app1"</span></span><br><span class="line">        keyPassword <span class="string">"111111"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    app2 &#123;</span><br><span class="line">        storeFile <span class="keyword">file</span>(<span class="string">"app2.jks"</span>)</span><br><span class="line">        storePassword <span class="string">"111111"</span></span><br><span class="line">        keyAlias <span class="string">"app2"</span></span><br><span class="line">        keyPassword <span class="string">"111111"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¤šä¸ªç­¾åæ–‡ä»¶ï¼Œåœ¨ <code>APP</code> è¿™ä¸ªç»´åº¦çš„ <code>flavor</code> ä¸­é…ç½®ç­¾åä¿¡æ¯ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app1&#123;</span><br><span class="line">    signingConfig signingConfigs.app1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app2&#123;</span><br><span class="line">    signingConfig signingConfigs.app2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥é’ˆå¯¹ä¸åŒçš„åº”ç”¨è®¾ç½®ä¸åŒçš„ç­¾åæ–‡ä»¶äº†ã€‚<strong>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œè¿™ä¸ªå‘æˆ‘ä»¥å‰æ²¡å¡«ä¸Šï¼Œè€Œæ˜¯ç»•è¿œè·¯ç»•è¿‡å»äº†ï¼Œç°åœ¨æˆ‘æ¥å¡«ä¸Šå®ƒï¼</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">    signingConfig <span class="keyword">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å®šè¦åœ¨ <code>debug</code> ä¸­å°†ç­¾åæ–‡ä»¶çš„é…ç½®ç½®ç©ºï¼Œä¸ç„¶ Build Type çš„æƒé™æ¯” Product Flavors è¦é«˜ï¼Œè€Œ <code>debug</code> Build Type(æ„å»ºç±»å‹) ä¼šè‡ªåŠ¨ä½¿ç”¨ <code>debug</code> SigningConfig (ç­¾åé…ç½®)ï¼Œè¿™æ ·ä¸€æ¥å°±å°† <code>flavor</code> ä¸­é…ç½®çš„ç­¾åä¿¡æ¯ç»™è¦†ç›–æ‰äº†ã€‚å¯¼è‡´çš„é—®é¢˜å°±æ˜¯ç¼–è¯‘ <code>release</code> åŒ…æ²¡æœ‰é—®é¢˜ï¼Œç¼–è¯‘ <code>debug</code> åŒ…å°±ä¸èƒ½ä½¿ç”¨æŸäº›éœ€è¦æ ¡éªŒç­¾åçš„ç¬¬ä¸‰æ–¹SDKäº†ã€‚</p><h2 id="é…ç½®ä¸åŒåº”ç”¨çš„ä»£ç å’Œèµ„æº"><a href="#é…ç½®ä¸åŒåº”ç”¨çš„ä»£ç å’Œèµ„æº" class="headerlink" title="é…ç½®ä¸åŒåº”ç”¨çš„ä»£ç å’Œèµ„æº"></a>é…ç½®ä¸åŒåº”ç”¨çš„ä»£ç å’Œèµ„æº</h2><p>ç»ˆäºæ¥åˆ°é‡å¤´æˆäº†ï¼Œç°åœ¨åªéœ€è¦æ›´æ¢ UIã€æ–‡æ¡ˆæˆ–è€…æŸäº›ç•Œé¢å¸ƒå±€å’Œé€»è¾‘ä»£ç å°±å¤§åŠŸå‘Šæˆå•¦ã€‚</p><p>é¦–å…ˆï¼Œå»ºç«‹æ¯ä¸ªåº”ç”¨å¯¹åº”çš„ <code>sourceSets</code> ç›®å½•ï¼Œæ¯”å¦‚ï¼š</p><ul><li>app1 çš„ <code>sourceSets</code> ä½ç½®æ˜¯ <code>src/app1/</code></li><li>app2 çš„ <code>sourceSets</code> ä½ç½®æ˜¯ <code>src/app2/</code></li></ul><p><code>app1</code> æ˜¯å·²ç»å¼€å‘å®Œæˆçš„åº”ç”¨ï¼Œåªéœ€è¦æ¢ UIã€æ–‡æ¡ˆå°±æˆäº† <code>app2</code>ï¼Œåœ¨ <code>src/app2/</code> ç›®å½•ä¸‹å†æ–°å»º <code>res</code> ç›®å½•ï¼Œå°†éœ€è¦æ›¿æ¢çš„åˆ‡å›¾å‘½åå’Œ <code>app1</code> ä¸­çš„å‘½åä¿æŒä¸€è‡´æ”¾å…¥ <code>res</code> å¯¹åº”çš„ç›®å½•ä¸‹å°±å®Œç¾æ¢è‚¤äº†ã€‚</p><p>æ–‡æ¡ˆåŒç†ï¼Œå°†éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸²åœ¨ <code>src/app2/res/values/strings.xml</code> ä¸­å†å†™ä¸€ä»½ï¼Œä¿æŒ <code>name</code> ç›¸åŒï¼Œå…¶ä¸­çš„å†…å®¹éšä¾¿æ›¿æ¢ã€‚</p><p>å¸ƒå±€æ–‡ä»¶ã€styleã€color æ›¿æ¢çš„è§„åˆ™åŒä¸Šã€‚</p><p>å¾®ä¿¡ç™»å½•ã€åˆ†äº«ã€æ”¯ä»˜çš„å›è°ƒæ˜¯è¿”å›åˆ° <code>{åº”ç”¨åŒ…å.wxapi.WXEntryActivity}</code>ã€<code>{åº”ç”¨åŒ…å.wxapi.WXPayEntryActivity}</code> è¿™ä¸¤ä¸ª Activityã€‚</p><p>æˆ‘ä»¬åœ¨ <code>app1</code> å’Œ <code>app2</code> ä¸­éƒ½æ”¾å…¥è¿™ä¸¤ä¸ªå›è°ƒ Activityï¼š</p><p><img src="http://images.imliujun.com/static/images/Gradle/sourceSets1.png" alt="sourceSets æ–‡ä»¶ç›®å½•"></p><p>ç„¶ååœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­åŠ¨æ€é…ç½® Activity çš„åŒ…åï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¾®ä¿¡åˆ†äº«å›è°ƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"$&#123;APPLICATIONID&#125;.wxapi.WXEntryActivity"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¾®ä¿¡æ”¯ä»˜çš„å›è°ƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"$&#123;APPLICATIONID&#125;.wxapi.WXPayEntryActivity"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><code>APPLICATIONID</code> å ä½ç¬¦åœ¨ Gradle ä¸­è®¾ç½®ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manifestPlaceholders = [APPLICATIONID : applicationId]</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨äº† <code>ShareSDK</code> åšç¬¬ä¸‰æ–¹åˆ†äº«å’Œç™»å½•ï¼Œéœ€è¦é…ç½® <code>ShareSDK.xml</code> æ”¾åˆ° <code>assets</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œå°† <code>main/assets/ShareSDK.xml</code> å¤åˆ¶ä¸€ä»½åˆ° <code>app2/assets/ShareSDK.xml</code>ï¼Œå°†é‡Œé¢çš„ç¬¬ä¸‰æ–¹ APP ID å’Œ APP KEY æ›¿æ¢ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><p>é¡¹ç›®å¦‚æœä½¿ç”¨äº† <code>ContentProvider</code> è¦æ³¨æ„æ›¿æ¢ <code>authorities</code>ï¼Œå¦‚æœ <code>authorities</code> é‡Œé¢çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰‹æœºä¸Šåªèƒ½è£…ä¸€ä¸ªåº”ç”¨å“¦ï¼Œå¯ä»¥å’Œä¸Šé¢åŠ¨æ€é…ç½® Activity åŒ…åä¸€æ ·æ“ä½œï¼Œç”¨ä¿¡é¸½ SDK æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- ã€å¿…é¡»ã€‘ ã€æ³¨æ„ã€‘authoritiesä¿®æ”¹ä¸º åŒ…å.AUTH_XGPUSH, å¦‚demoçš„åŒ…åä¸ºï¼šcom.qq.xgdemo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.tencent.android.tpush.XGPushProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">"$&#123;APPLICATIONID&#125;.AUTH_XGPUSH"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šé¢çš„å†…å®¹åŸºæœ¬æ¶‰åŠåˆ°æ‰€æœ‰çš„æ–¹é¢ï¼Œå…¶ä»–çš„ç»†èŠ‚ä¹Ÿå¥½ï¼Œç‰¹æ®Šçš„éœ€æ±‚å®šåˆ¶ä¹Ÿå¥½ï¼Œä½¿ç”¨ä¸Šé¢çš„æ–¹å¼å»å¤„ç†éƒ½èƒ½å¤Ÿè§£å†³ã€‚å¸Œæœ›å¤§å®¶ä¸è¦å…‰å­¦ä¼šå¤åˆ¶ç²˜è´´ï¼Œè¦æŒæ¡å…¶åŸç†ï¼Œé‡åˆ°ç±»ä¼¼çš„éœ€æ±‚å°±èƒ½ä¸¾ä¸€åä¸‰ã€‚</p><blockquote><p>demoåœ°å€ï¼š<a href="https://github.com/imliujun/GradleTest" target="_blank" rel="noopener">https://github.com/imliujun/GradleTest</a></p></blockquote><p>æ€»ç»“ä¸€ä¸‹æŠ€æœ¯ç‚¹ï¼š</p><ul><li><code>manifestPlaceholders</code> -&gt; <code>AndroidManifest.xml</code> å ä½ç¬¦</li><li><code>buildConfigField</code> -&gt; <code>BuildConfig</code> åŠ¨æ€é…ç½®å¸¸é‡å€¼</li><li><code>resValue</code> -&gt; <code>String.xml</code> åŠ¨æ€é…ç½®å­—ç¬¦ä¸²</li><li><code>signingConfigs</code> -&gt; é…ç½®ç­¾åæ–‡ä»¶</li><li><code>productFlavors</code> -&gt; äº§å“å®šåˆ¶å¤šç‰ˆæœ¬</li><li><code>flavorDimensions</code> -&gt; ä¸ºäº§å“å®šåˆ¶è®¾ç½®å¤šä¸ªç»´åº¦</li><li><code>android.applicationVariants</code> -&gt; æ“ä½œ task</li></ul><h1 id="ç›¸å…³é˜…è¯»"><a href="#ç›¸å…³é˜…è¯»" class="headerlink" title="ç›¸å…³é˜…è¯»"></a>ç›¸å…³é˜…è¯»</h1><ul><li><a href="http://www.imliujun.com/gradle1.html">ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</a></li><li><a href="http://www.imliujun.com/gradle2.html">Android Studio 3.0 ä¸Š Gradle æ”¹åŠ¨</a></li></ul><p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img src="http://images.imliujun.com/static/images/wx_qrcode.png" alt="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿ "></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨æ–‡ç«  &lt;a href=&quot;http://www.imliujun.com/gradle1.html&quot;&gt;ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶&lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé’ˆå¯¹ä¸€ä¸ªåº”ç”¨çš„æ­£å¼æœã€æµ‹è¯•æœã€è¶…ç®¡æœç­‰å…¶ä»–ç‰ˆæœ¬ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚&lt;br&gt;è¿™ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬æ¥ç‚¹å¤§åŠ¨ä½œï¼Œè®©ä½ ç”¨ä¸€å¥—ä»£
      
    
    </summary>
    
      <category term="Android" scheme="http://www.imliujun.com/categories/Android/"/>
    
    
      <category term="Gradle" scheme="http://www.imliujun.com/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>Android Studio 3.0 ä¸Š Gradle æ”¹åŠ¨</title>
    <link href="http://www.imliujun.com/gradle2.html"/>
    <id>http://www.imliujun.com/gradle2.html</id>
    <published>2017-07-11T07:02:19.000Z</published>
    <updated>2017-07-11T07:23:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="http://www.imliujun.com/gradle1.html">ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</a> ä¸­ä½¿ç”¨åˆ°äº† <code>productFlavors</code>ï¼Œæœ‰åŒå­¦è¯„è®ºåœ¨ Android Studio 3.0 ä¸Šç¼–è¯‘ä¸äº†ã€‚</p><p><a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p><p><img src="http://images.imliujun.com/static/images/Gradle/AndroidStudio3_update.png" alt="å®˜æ–¹è¯´æ˜"></p><p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼Œ<code>&#39;com.android.tools.build:gradle:3.0.0-alpha5&#39;</code> æ’ä»¶ 3.0.0 ç‰ˆæœ¬åŒ…å«ä¸€ä¸ªæ–°çš„ä¾èµ–æœºåˆ¶ï¼Œå¼ºåˆ¶æ‰€æœ‰çš„ <code>flavor</code> å¿…é¡»é…ç½®ä¸€ä¸ª <code>flavor dimension</code>ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„åŸºç¡€ä¸Šï¼Œç¨ä½œä¿®æ”¹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é…ç½®ä¸€ä¸ªé»˜è®¤çš„ flavorDimensions</span></span><br><span class="line">flavorDimensions <span class="string">"SERVER"</span></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        offline &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span> <span class="comment">//è®¾ç½®</span></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://offline.domain.com/\""</span></span><br><span class="line">            versionName getTestVersionName() <span class="comment">//ä¿®æ”¹ versionName</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        online &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://online.domain.com/\""</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        admin &#123;</span><br><span class="line">            dimension <span class="string">"SERVER"</span></span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://admin.domain.com/\""</span></span><br><span class="line">            versionName rootProject.ext.APP1_VERSION_NAME + <span class="string">"-ç®¡ç†å‘˜"</span> <span class="comment">//ä¿®æ”¹ versionName</span></span><br><span class="line">            manifestPlaceholders.UMENG_CHANNEL_VALUE = <span class="string">"admin"</span> <span class="comment">//ä¿®æ”¹æ¸ é“å</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯ç»™ <code>flavor</code> è®¾ç½®é»˜è®¤çš„ <code>Dimension</code> ï¼Œè¿™æ ·ç¼–è¯‘å°±æ²¡æœ‰é—®é¢˜äº†ã€‚</p><h1 id="ç›¸å…³é˜…è¯»"><a href="#ç›¸å…³é˜…è¯»" class="headerlink" title="ç›¸å…³é˜…è¯»"></a>ç›¸å…³é˜…è¯»</h1><p><a href="http://www.imliujun.com/gradle1.html">ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</a></p><p><a href="http://www.imliujun.com/gradle3.html">ä½¿ç”¨ Gradle å®ç°ä¸€å¥—ä»£ç å¼€å‘å¤šä¸ªåº”ç”¨</a></p><p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img src="http://images.imliujun.com/static/images/wx_qrcode.png" alt="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿ "></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šä¸€ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;http://www.imliujun.com/gradle1.html&quot;&gt;ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶&lt;/a&gt; ä¸­ä½¿ç”¨åˆ°äº† &lt;code&gt;productFlavors&lt;/code&gt;ï¼Œæœ‰åŒå­¦è¯„è®ºåœ¨ Android Studio 3.0
      
    
    </summary>
    
      <category term="Android" scheme="http://www.imliujun.com/categories/Android/"/>
    
    
      <category term="Gradle" scheme="http://www.imliujun.com/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</title>
    <link href="http://www.imliujun.com/gradle1.html"/>
    <id>http://www.imliujun.com/gradle1.html</id>
    <published>2017-07-07T08:19:23.000Z</published>
    <updated>2017-07-11T07:23:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>å•¥ä¹Ÿä¸è¯´äº†ï¼Œç›´æ¥è¿›å…¥ä¸»é¢˜å§ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦æ ¹æ®å®é™…å¼€å‘ä¸­é‡åˆ°çš„éœ€æ±‚ï¼Œè®²è§£ä½¿ç”¨ <code>Gradle</code> å¯¹åº”ç”¨çš„ä¸åŒç‰ˆæœ¬è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚</p><h1 id="åœºæ™¯ä»‹ç»"><a href="#åœºæ™¯ä»‹ç»" class="headerlink" title="åœºæ™¯ä»‹ç»"></a>åœºæ™¯ä»‹ç»</h1><ol><li>ä¸€èˆ¬çš„åº”ç”¨åŸºæœ¬ä¸Šéƒ½æœ‰æ­£å¼æœå’Œæµ‹è¯•æœï¼Œè¿™ä¸ªå°±ä¸éœ€è¦å¤šè¯´äº†ã€‚ä½†æ˜¯æœ‰äº›åº”ç”¨å¯èƒ½è¿˜æœ‰<code>è¶…ç®¡æœåŠ¡å™¨</code>ä¸“ä¾›è¿è¥äººå‘˜ä½¿ç”¨ï¼Œå¯¹åº”ç”¨å†…çš„ä¸€äº›å†…å®¹è¿›è¡Œç›‘ç®¡ï¼Œå…·æœ‰ä¸€äº›ç®¡ç†å‘˜æ‰æœ‰çš„æ“ä½œæƒé™ã€‚</li><li>å¼€å‘è¿‡ç¨‹ä¸­å‘å¸ƒæµ‹è¯•æœåŠ¡å™¨çš„å®‰è£…åŒ…éœ€è¦åœ¨ç‰ˆæœ¬å·åé¢å¢åŠ ç‰ˆæœ¬åºå·ï¼Œè¶…ç®¡æœåŠ¡å™¨çš„åŒ…åœ¨ç‰ˆæœ¬å·åé¢å¢åŠ <code>ç®¡ç†å‘˜</code>æ–‡å­—ï¼Œçº¿ä¸ŠåŒ…åˆ™æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·ã€‚</li><li>æ¯æ¬¡æ‰“åŒ… <code>versionCode</code> è‡ªå¢ï¼Œé¿å…å‘ç‰ˆæ—¶å¿˜è®°æ‰‹åŠ¨ä¿®æ”¹å¯¼è‡´è€ç‰ˆæœ¬ä¸èƒ½è¦†ç›–å®‰è£…ã€‚</li><li>è¶…ç®¡åŒ…çš„æ¸ é“åä¸º <code>admin</code>ï¼Œæ—¥å¸¸è¿è¡Œçš„ <code>debug</code> åŒ…æ¸ é“åä¸º <code>test</code>ï¼Œä¸Šçº¿çš„åŒ…ä½¿ç”¨åŠ å›ºè½¯ä»¶è¿›è¡Œå¤šæ¸ é“åŠ å›ºã€‚</li><li><code>debug</code> åŒ…å’Œ <code>release</code> åŒ…ä½¿ç”¨åŒæ ·çš„ç­¾åï¼Œé¿å…ç›´æ¥è¿è¡Œçš„ <code>debug</code> åŒ…å› ä¸ºç­¾åé—®é¢˜ä¸èƒ½ä½¿ç”¨éœ€è¦æ ¡éªŒç­¾åçš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæ¯”å¦‚ï¼šQQ ç™»å½•ï¼Œå¾®ä¿¡ç™»å½•ï¼Œé«˜å¾·åœ°å›¾ã€‚</li><li><code>debug</code> åŒ…æ‰“å°æ—¥å¿—ä¿¡æ¯ï¼Œ<code>release</code> åŒ…ä¸æ‰“å°æ—¥å¿—ä¿¡æ¯</li></ol><p>ä»¥ä¸ŠæŸäº›åœºæ™¯ä»æˆ‘å·¥ä½œä»¥æ¥å°±ä¸€ç›´å­˜åœ¨ï¼Œä»¥å‰ç”¨ <code>eclipse</code> å¼€å‘æ—¶é™¤äº†æ¯æ¬¡éƒ½æ‰‹åŠ¨å»ä¿®æ”¹ä¸€äº›å¼€å…³å˜é‡ä¹Ÿæ²¡å•¥å¥½åŠæ³•ï¼Œå¯èƒ½æ˜¯å› ä¸ºå½“æ—¶èœ â•®(â•¯â–½â•°)â•­ï¼ˆå¦‚æœä½ ä»¬æœ‰ä»€ä¹ˆå¥½æ–¹æ³•çš„è¯ï¼‰ã€‚åæ¥åˆ‡æ¢åˆ° <code>Android Studio</code> åä½¿ç”¨ <code>Gradle</code> è¿›è¡Œä¾èµ–ç®¡ç†å·²ç»è®©äººå¾ˆæ˜¯æ¬£å–œï¼Œæ—¢ç„¶å¦‚æ­¤èƒ½ä¸èƒ½ä½¿ç”¨ <code>Gradle</code> å°†ä»¥ä¸Šé—®é¢˜ç»Ÿç»Ÿè§£å†³ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå¿…é¡»çš„ã€‚</p><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><p>å…ˆä¸Šå®Œæ•´çš„ <code>Gradle</code> é…ç½®ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">25</span></span><br><span class="line">    buildToolsVersion <span class="string">"25.0.3"</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"com.imliujun.gradle"</span></span><br><span class="line">        minSdkVersion <span class="number">16</span></span><br><span class="line">        targetSdkVersion <span class="number">25</span></span><br><span class="line">        versionCode gitVersionCode()  <span class="comment">//è·å– git çš„ commit æ¬¡æ•°</span></span><br><span class="line">        versionName rootProject.ext.versionName</span><br><span class="line"></span><br><span class="line">        manifestPlaceholders = [UMENG_APP_KEY      : <span class="string">"å¡«ä½ çš„å‹ç›Ÿ APP KEY"</span>,</span><br><span class="line">                                UMENG_CHANNEL_VALUE: <span class="string">"é»˜è®¤çš„æ¸ é“å"</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    signingConfigs &#123;</span><br><span class="line"><span class="comment">//åœ¨è¿™é‡Œé…ç½®ç›¸å…³çš„ç­¾åä¿¡æ¯</span></span><br><span class="line">        keyStore &#123;</span><br><span class="line">            storeFile <span class="keyword">file</span>(<span class="string">"test.jks"</span>)</span><br><span class="line">            storePassword <span class="string">"111111"</span></span><br><span class="line">            keyAlias <span class="string">"test"</span></span><br><span class="line">            keyPassword <span class="string">"111111"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">// ä¸æ˜¾ç¤ºLog</span></span><br><span class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"false"</span></span><br><span class="line">            signingConfig signingConfigs.keyStore <span class="comment">//è®¾ç½®ç­¾åæ–‡ä»¶</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            <span class="comment">// æ˜¾ç¤ºLog</span></span><br><span class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"true"</span></span><br><span class="line">            versionNameSuffix <span class="string">"-debug"</span>  <span class="comment">//è®¾ç½®åç¼€</span></span><br><span class="line">            signingConfig signingConfigs.keyStore  <span class="comment">//è®¾ç½®ç­¾åæ–‡ä»¶</span></span><br><span class="line">            manifestPlaceholders.UMENG_CHANNEL_VALUE = <span class="string">"test"</span> <span class="comment">//ä¿®æ”¹æ¸ é“å</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        offline &#123;</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://offline.domain.com/\""</span></span><br><span class="line">            versionName getTestVersionName() <span class="comment">//ä¿®æ”¹ versionName</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        online &#123;</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://online.domain.com/\""</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        admin &#123;</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"DOMAIN_NAME"</span>, <span class="string">"\"https://admin.domain.com/\""</span></span><br><span class="line">            versionName rootProject.ext.versionName + <span class="string">"-ç®¡ç†å‘˜"</span> <span class="comment">//ä¿®æ”¹ versionName</span></span><br><span class="line">            manifestPlaceholders.UMENG_CHANNEL_VALUE = <span class="string">"admin"</span> <span class="comment">//ä¿®æ”¹æ¸ é“å</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•ä¸‹çš„ <code>build.gradle</code> æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œä¸»è¦æ˜¯å°†ç‰ˆæœ¬å·å’Œæµ‹è¯•åŒ…çš„åºå·æŠ½å–å‡ºæ¥ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">    versionName = <span class="string">"2.0.2"</span></span><br><span class="line">    testNum = <span class="string">"0001"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getTestVersionName() &#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"%s.%s"</span>, rootProject.ext.versionName,</span><br><span class="line">            rootProject.ext.testNum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> gitVersionCode() &#123;</span><br><span class="line">    <span class="keyword">def</span> <span class="keyword">count</span> = <span class="string">"git rev-list HEAD --count"</span>.execute().text.trim()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">count</span>.isInteger() ? <span class="keyword">count</span>.<span class="keyword">toInteger</span>() : <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±æ ¹æ®åœºæ™¯æ¥ä¾æ¬¡ä»‹ç»å¯¹åº”çš„é…ç½®ä»£ç ã€‚</p><h2 id="é…ç½®æœåŠ¡å™¨ç‰ˆæœ¬"><a href="#é…ç½®æœåŠ¡å™¨ç‰ˆæœ¬" class="headerlink" title="é…ç½®æœåŠ¡å™¨ç‰ˆæœ¬"></a>é…ç½®æœåŠ¡å™¨ç‰ˆæœ¬</h2><p>è¿™é‡Œåˆ›å»ºäº†ä¸‰ä¸ª flavorï¼Œåˆ†åˆ«æ˜¯ <code>offline æµ‹è¯•æœ</code>ã€<code>online æ­£å¼æœ</code>ã€<code>admin è¶…ç®¡æœ</code>ã€‚å¹¶ä¸”é€šè¿‡ <code>buildConfigField</code> åŠ¨æ€é…ç½®æœåŠ¡å™¨çš„ URL å¸¸é‡å€¼åˆ°ç¼–è¯‘åè‡ªåŠ¨ç”Ÿæˆçš„ <code>BuildConfig</code> ç±»ä¸­ã€‚</p><p><img src="http://images.imliujun.com/static/images/Gradle/BuildConfig.png" alt="è‡ªåŠ¨ç”Ÿæˆçš„ BuildConfig ç±»" title="BuildConfig"></p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸æ­¢æœ‰ <code>DOMAIN_NAME</code> å¸¸é‡å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>FLAVOR</code> å¸¸é‡ã€‚è¿™ä¸ª <code>FLAVOR</code> å¸¸é‡ä¸­çš„å€¼æ˜¯ <code>offline</code>ï¼Œä»£è¡¨å½“å‰åœ¨ <code>offline</code> è¿™ä¸ªç‰ˆæœ¬ä¸Šé¢ã€‚é‚£æ€ä¹ˆåˆ‡æ¢åˆ°å…¶ä»–çš„æœåŠ¡å™¨å‘¢ï¼Ÿ</p><p><img src="http://images.imliujun.com/static/images/Gradle/SwitchBuildVariants.png" alt="åˆ‡æ¢ä¸åŒçš„å˜ç§ç‰ˆæœ¬" title="BuildVariants"></p><p>ç‚¹å¼€å·¦ä¸‹è§’çš„ <code>Build Variants</code>, å¯ä»¥è‡ªç”±åˆ‡æ¢å½“å‰è¿è¡Œçš„ç‰ˆæœ¬ã€‚éœ€è¦åœ¨ç®¡ç†å‘˜åŒ…ä¸­å¼€å¯ä¸€äº›é«˜çº§çš„åŠŸèƒ½ï¼Œå¯ä»¥åˆ¤æ–­ <code>FLAVOR</code> çš„å€¼æ˜¯ä¸æ˜¯ <code>admin</code>ï¼Œå¦‚æœæ˜¯çš„è¯å°±æ˜¾ç¤ºç®¡ç†å‘˜çš„æ“ä½œå¸ƒå±€ã€‚å½“ç„¶å¿…ä¸å¯å°‘çš„è¦å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ ¡éªŒå“¦ã€‚</p><h2 id="å®šåˆ¶-versionName"><a href="#å®šåˆ¶-versionName" class="headerlink" title="å®šåˆ¶ versionName"></a>å®šåˆ¶ <code>versionName</code></h2><p>å¤§å®¶çœ‹ä¸Šå›¾ <code>BuildConfig</code> ç±»ä¸­ <code>VERSION_NAME</code> å¸¸é‡çš„å€¼ä¸º <code>2.0.2.0001-debug</code>ï¼Œå½“å‰æ˜¯æµ‹è¯•æœçš„ <code>debug</code> åŒ…ï¼Œæ‰€ä»¥ <code>versionName</code> åº”è¯¥æ˜¯æ­£å¸¸çš„ 2.0.2 ç‰ˆæœ¬åé¢æ‹¼ä¸Šå½“å‰å‡ºåŒ…çš„åºå· 0001 ï¼Œå†æ‹¼ä¸Š <code>debug</code> çš„åç¼€ï¼Œæ‰€ä»¥å®Œæ•´çš„ç‰ˆæœ¬å·æ˜¯ <code>2.0.2.0001-debug</code>ã€‚</p><p>çœ‹çœ‹ä¸åŒæœåŠ¡å™¨ç‰ˆæœ¬çš„ <code>VERSION_NAME</code> ï¼š</p><ul><li><code>offlineRelease</code> ç‰ˆæœ¬ä¸º <code>2.0.2.0001</code></li><li><code>offlineDebug</code>   ç‰ˆæœ¬ä¸º <code>2.0.2.0001-debug</code></li><li><code>adminRelease</code> ç‰ˆæœ¬ä¸º <code>2.0.2-ç®¡ç†å‘˜</code></li><li><code>adminDebug</code>   ç‰ˆæœ¬ä¸º <code>2.0.2-ç®¡ç†å‘˜-debug</code></li><li><code>onlineRelease</code> ç‰ˆæœ¬ä¸º <code>2.0.2</code></li><li><code>onlineDebug</code>   ç‰ˆæœ¬ä¸º <code>2.0.2-debug</code></li></ul><p>å¦‚æœæˆ‘ä»¬æ¥å£éœ€è¦ä¸Šä¼ ç‰ˆæœ¬å·ç»™æœåŠ¡å™¨å‘¢ï¼Ÿè‚¯å®šä¸èƒ½ç›´æ¥ä¸Šä¼ è¿™äº›å®šåˆ¶åŒ–åçš„ <code>VERSION_NAME</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ <code>Gradle</code> ä¸­å¢åŠ ä¸€ä¸ª <code>buildConfigField</code> å°†åŸå§‹çš„ç‰ˆæœ¬å·å­˜èµ·æ¥å°±å¥½äº†ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildConfigField <span class="string">"String"</span>, <span class="string">"versionNumber"</span>, <span class="string">"\"$&#123;rootProject.ext.versionName&#125;\""</span></span><br></pre></td></tr></table></figure><h2 id="versionCode-è‡ªå¢"><a href="#versionCode-è‡ªå¢" class="headerlink" title="versionCode è‡ªå¢"></a><code>versionCode</code> è‡ªå¢</h2><p>è¿™é‡Œé‡‡ç”¨äº†ä¸»æµçš„æ–¹å¼ï¼Œä½¿ç”¨ <code>git</code> çš„ <code>commit</code> æ¬¡æ•°ä½œä¸º <code>versionCode</code> çš„å€¼ã€‚ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªå€¼ä¼šè¶…è¿‡ <code>int</code> çš„ä¸Šé™ï¼Œä½ å¾—æ•²çƒ‚å¤šå°‘é”®ç›˜æ‰èƒ½æäº¤ 2147483648æ¬¡ <code>commit</code>ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> gitVersionCode() &#123;</span><br><span class="line">    <span class="keyword">def</span> <span class="keyword">count</span> = <span class="string">"git rev-list HEAD --count"</span>.execute().text.trim()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">count</span>.isInteger() ? <span class="keyword">count</span>.<span class="keyword">toInteger</span>() : <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ªæ€§åŒ–æ¸ é“å"><a href="#ä¸ªæ€§åŒ–æ¸ é“å" class="headerlink" title="ä¸ªæ€§åŒ–æ¸ é“å"></a>ä¸ªæ€§åŒ–æ¸ é“å</h2><p><code>Gradle</code> å¤šæ¸ é“æ‰“åŒ…çš„æ–‡ç« å¤ªå¤šäº†ï¼Œç›¸å…³çš„åŸºç¡€æˆ‘å°±ä¸è®²äº†ã€‚ç®€å•è®²ä¸‹æœ¬æ–‡ç›¸å…³çš„é…ç½®å§ã€‚</p><p>é€šè¿‡å®šä¹‰ <code>manifestPlaceholders</code> é”®å€¼å¯¹ï¼Œåœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­ä½¿ç”¨å ä½ç¬¦çš„æ–¹å¼åŠ¨æ€è¾“å…¥ <code>UMENG_APPKEY</code> å’Œ <code>UMENG_CHANNEL</code> ã€‚</p><p>ç„¶ååœ¨ <code>debug</code> çš„ <code>buildType</code> ä¸­ä¿®æ”¹æ¸ é“åä¸º <code>test</code>ï¼Œåœ¨ <code>admin</code> çš„ <code>Flavor</code> ä¸­ä¿®æ”¹æ¸ é“åä¸º <code>admin</code>ã€‚å¦‚æœé€‰æ‹© <code>adminDebug</code> ç‰ˆæœ¬ï¼Œåˆ™æ¸ é“åä¸º <code>test</code>ï¼Œ<code>buildType</code> ä¸­çš„é…ç½®ä¼šè¦†ç›–æ‰ <code>Flavor</code> ä¸­çš„é…ç½®ã€‚</p><p>ç”±äºæˆ‘ä»¬çº¿ä¸Šä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å›ºï¼Œæ‰€ä»¥å¤šæ¸ é“åŒ…å°±äº¤ç»™ç¬¬ä¸‰æ–¹åŠ å›ºè½¯ä»¶æ¥ç”Ÿæˆäº†ã€‚</p><p>å…³äºå¤šæ¸ é“æ‰“åŒ…æˆ‘è¿˜æœ‰ä¸¤å¥è¯è¦è¯´ï¼Œä»¥å‰ä½¿ç”¨ <code>Gradle</code> è¿›è¡Œå¤šæ¸ é“æ‰“åŒ…ï¼Œé€šè¿‡ä»£ç è‡ªå®šä¹‰ä¿®æ”¹ <code>apk</code> æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ï¼Œ<code>Android Studio</code> ç¼–è¯‘çš„æ—¶å€™æ—¶ä¸æ—¶çš„æŠ¥ä¸€äº›æ–‡ä»¶æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œä»¥å‰éƒ½æ˜¯é€šè¿‡åœ¨ <code>Gradle</code> æ–‡ä»¶ä¸­éšä¾¿ä¿®æ”¹ä¸€ç‚¹ä¸œè¥¿ç„¶ååˆ·æ–°ä¸€ä¸‹ <code>Gradle</code> æ–‡ä»¶æ¥è§£å†³ã€‚ç°åœ¨æˆ‘æ‰“åŒ…ä¸ä¿®æ”¹è¾“å‡ºè·¯å¾„ï¼Œå†ä¹Ÿæ²¡é‡åˆ°ä»¥å‰çš„é‚£äº›é—®é¢˜äº†ã€‚</p><p>å»ºè®®å¤§å®¶ä½¿ç”¨ <code>assemble</code> å‘½ä»¤æ¥è¿›è¡Œæ‰“åŒ…ï¼Œæ¯”å¦‚æˆ‘è¦å‡ºä¸€ä¸ªæµ‹è¯•åŒ…ä½¿ç”¨ <code>./gradlew assembleOfflineRelease</code> å‘½ä»¤ï¼Œ<code>apk</code> æ–‡ä»¶ç”Ÿæˆåœ¨ <code>/build/outputs/apk/</code> ç›®å½•ä¸‹ã€‚ç›´æ¥æ‰§è¡Œ <code>assemble</code> å‘½ä»¤æ˜¯ç¼–è¯‘ <code>Build Variants</code> ä¸­çš„æ‰€æœ‰åŒ…ï¼Œå¦‚æœä½ è¦ç¼–è¯‘æŒ‡å®šç‰ˆæœ¬çš„åŒ…ï¼Œç›´æ¥åœ¨ <code>assemble</code> å‘½ä»¤åé¢æ‹¼ä¸ŠæŒ‡å®šçš„ <code>Build Variant</code> å°±å¥½äº†ã€‚</p><h2 id="debug-åŒ…ä½¿ç”¨-release-ç­¾å"><a href="#debug-åŒ…ä½¿ç”¨-release-ç­¾å" class="headerlink" title="debug åŒ…ä½¿ç”¨ release ç­¾å"></a><code>debug</code> åŒ…ä½¿ç”¨ <code>release</code> ç­¾å</h2><p>è¿™ä¸ªé—®é¢˜åœ¨ <code>eclipse</code> æ—¶ä»£ï¼Œå¯ä»¥ç›´æ¥åœ¨è®¾ç½®é‡Œé¢é…ç½® <code>debug</code> ç­¾åæ–‡ä»¶ä¸º <code>release</code> çš„ç­¾åæ–‡ä»¶ã€‚<br>ç”¨ <code>Android Studio</code> åªéœ€è¦åœ¨ <code>Gradle</code> ä¸­é…ç½®å°±å¥½äº†ã€‚</p><p>é¦–å…ˆé…ç½®ç­¾åæ–‡ä»¶çš„ä¿¡æ¯ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line"> <span class="comment">//åœ¨è¿™é‡Œé…ç½®ç›¸å…³çš„ç­¾åä¿¡æ¯</span></span><br><span class="line">  keyStore &#123;</span><br><span class="line">    storeFile <span class="keyword">file</span>(<span class="string">"test.jks"</span>)</span><br><span class="line">    storePassword <span class="string">"111111"</span></span><br><span class="line">    keyAlias <span class="string">"test"</span></span><br><span class="line">    keyPassword <span class="string">"111111"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>buildTypes</code> ä¸­è®¾ç½®ç­¾åä¿¡æ¯ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">  release &#123;</span><br><span class="line">    signingConfig signingConfigs.keyStore <span class="comment">//è®¾ç½®ç­¾åæ–‡ä»¶</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  debug &#123;</span><br><span class="line">    signingConfig signingConfigs.keyStore  <span class="comment">//è®¾ç½®ç­¾åæ–‡ä»¶</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—å¼€å…³"><a href="#æ—¥å¿—å¼€å…³" class="headerlink" title="æ—¥å¿—å¼€å…³"></a>æ—¥å¿—å¼€å…³</h2><p>è¿™ä¸ªå¤ªç®€å•äº†ï¼Œä¸æƒ³å•ç‹¬åˆ—å‡ºæ¥ã€‚ä¸è¿‡ä¸Šé¢åœºæ™¯é‡Œé¢æå‡ºæ¥äº†ï¼Œå°±ç®€å•ä¸€è¡Œä»£ç å±•ç¤ºå§ã€‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">release &#123;</span><br><span class="line"><span class="comment">// ä¸æ˜¾ç¤ºLog</span></span><br><span class="line">buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"false"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">debug &#123;</span><br><span class="line"><span class="comment">// æ˜¾ç¤ºLog</span></span><br><span class="line">buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"true"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ—¥å¿—å·¥å…·ç±»ä¸­ä½¿ç”¨ <code>BuildConfig</code> ç±»ä¸­çš„ <code>LOG_DEBUG</code> å¸¸é‡æ¥åˆ¤æ–­å½“å‰æ˜¯å¦åº”è¯¥è¾“å‡ºæ—¥å¿—ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå¼€å…³æ¥æ§åˆ¶å¼€å¯ä¸¥æ ¼æ¨¡å¼ç­‰å…¶ä»–åªé€‚åˆåœ¨ <code>debug</code> æ¨¡å¼ä¸‹å¼€å¯çš„è®¾ç½®ã€‚</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>å”§å”§æ­ªæ­ªè¯´äº†è¿™ä¹ˆå¤šï¼Œåœ¨æ‡‚çš„äººçœ¼ä¸­è‡ªç„¶å¾ˆç®€å•ï¼Œåœ¨å¯¹ <code>gradle</code> ä¸€ç‚¹éƒ½ä¸äº†è§£çš„äººçœ¼ä¸­å°±å¯ä»¥ç›´æ¥å¤åˆ¶è¿‡å»ç”¨äº†ã€‚å½“ç„¶æˆ‘æ˜¯ä¸å»ºè®®ç›´æ¥å¤åˆ¶ï¼Œæ¯•ç«Ÿéœ€æ±‚ç¨å¾®ä¸€æ”¹ï¼Œä½ å¯èƒ½å°±æŸæ‰‹æ— ç­–äº†ã€‚å»ºè®®å¤§å®¶è¿˜æ˜¯ä»¥ç†è§£ä¸ºä¸»ï¼ŒæŒæ¡å…¶åŸç†è‡ªç„¶ä¸€é€šç™¾é€šã€‚</p><h1 id="ç›¸å…³é˜…è¯»"><a href="#ç›¸å…³é˜…è¯»" class="headerlink" title="ç›¸å…³é˜…è¯»"></a>ç›¸å…³é˜…è¯»</h1><p><a href="http://www.imliujun.com/gradle2.html">Android Studio 3.0 ä¸Š Gradle æ”¹åŠ¨</a></p><p><a href="http://www.imliujun.com/gradle3.html">ä½¿ç”¨ Gradle å®ç°ä¸€å¥—ä»£ç å¼€å‘å¤šä¸ªåº”ç”¨</a></p><p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img title="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿" src="http://images.imliujun.com/static/images/wx_qrcode.png"></p>]]></content>
    
    <summary type="html">
    
      æœ¬ç¯‡æ–‡ç« ä¸»è¦æ ¹æ®å®é™…å¼€å‘ä¸­é‡åˆ°çš„éœ€æ±‚ï¼Œè®²è§£ä½¿ç”¨ `Gradle` å¯¹åº”ç”¨çš„ä¸åŒç‰ˆæœ¬è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚é¿å…æ‰‹åŠ¨ä¿®æ”¹ä¸€äº›å¼€å…³å˜é‡ï¼Œå¯¼è‡´è¯¯æ“ä½œç­‰ç­‰ã€‚
    
    </summary>
    
      <category term="Android" scheme="http://www.imliujun.com/categories/Android/"/>
    
    
      <category term="Gradle" scheme="http://www.imliujun.com/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>Lottie -- è½»æ¾å®ç°åŠ¨æ€åŠ è½½ç›´æ’­ç¤¼ç‰©åŠ¨ç”»</title>
    <link href="http://www.imliujun.com/Lottie%E5%BA%93%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD%E7%A4%BC%E7%89%A9%E5%8A%A8%E7%94%BB.html"/>
    <id>http://www.imliujun.com/Lottieåº“å®ç°ç›´æ’­ç¤¼ç‰©åŠ¨ç”».html</id>
    <published>2017-04-24T23:27:11.000Z</published>
    <updated>2017-06-23T09:33:39.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å·²æˆæƒå¾®ä¿¡å…¬ä¼—å·ï¼šé¸¿æ´‹ï¼ˆhongyangAndroidï¼‰åŸåˆ›é¦–å‘ã€‚</p></blockquote><p>æœ¬æ–‡ä¸»è¦è®²è§£ <a href="https://github.com/airbnb/lottie-android" target="_blank" rel="noopener">Lottie</a> åº“åŠ¨æ€åŠ è½½ SD å¡ä¸Šå¸¦å›¾ç‰‡èµ„æºçš„åŠ¨ç”»ï¼Œå¹¶å¯¹å„ç§æœºå‹åšå…¨å±é€‚é…ã€‚</p><p>Lottie çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>è·¨å¹³å°ï¼Œæ”¯æŒ Androidã€iOSã€React Native å¹³å°</p></li><li><p>æ”¯æŒå®æ—¶æ¸²æŸ“ After Effects åŠ¨ç”»ï¼Œè®© app åŠ è½½åŠ¨ç”»åƒåŠ è½½å›¾ç‰‡ä¸€æ ·ç®€å•ã€‚</p></li><li><p>èµ„æºåŠ¨æ€ä¸‹è½½ï¼Œå‡å° APP ä½“ç§¯ï¼Œä¸Šçº¿æ–°çš„åŠ¨ç”»æ•ˆæœä¸éœ€è¦å‘ç‰ˆ</p></li><li><p>æ›´å¤šä¼˜ç‚¹ç­‰ä½ å‘ç°</p></li></ul><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ul><li><p>åšç›´æ’­è½¯ä»¶è‚¯å®šå°‘ä¸äº†å„ç§ç¤¼ç‰©çš„åŠ¨ç”»æ•ˆæœï¼Œå½“ä¸Šçº¿æ–°çš„ç¤¼ç‰©æ—¶ï¼Œä¸ä»… Androidã€ios å®¢æˆ·ç«¯éœ€è¦å®ç°æ–°çš„åŠ¨ç”»æ•ˆæœï¼Œè¿˜å¾ˆéš¾å…¼å®¹è€ç‰ˆæœ¬ã€‚</p></li><li><p>å¹³å¸¸è¿‡èŠ‚æ—¥çš„æ—¶å€™ï¼Œå¾ˆå¤š APP éƒ½ä¼šåšå„ç§æ´»åŠ¨ï¼Œä¿®æ”¹å¯åŠ¨é¡µçš„å›¾ç‰‡ï¼Œæ›´æ”¹åº”ç”¨å†…çš„æŒ‰é’®å›¾æ ‡ï¼Œå¦‚æœæ¶‰åŠåˆ°åŠ¨ç”»ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦æå‰ä¸€ä¸¤ä¸ªç‰ˆæœ¬å°†èŠ‚æ—¥çš„åŠ¨ç”»å®ç°ä»£ç é¢„åˆ¶åˆ°åº”ç”¨å†…</p></li><li><p>æ›´å¤šåº”ç”¨åœºæ™¯ç­‰ä½ æ¢ç´¢</p></li></ul><p>ç°åœ¨æœ‰äº† Lottieï¼Œå¯ä»¥è®©è®¾è®¡å¸ˆä½¿ç”¨ After Effects è¿›è¡ŒåŠ¨ç”»è®¾è®¡ï¼Œé€šè¿‡ Bodymovin æ’ä»¶å¯¼å‡º json æ–‡ä»¶ï¼Œå°†åŠ¨ç”»èµ„æºæ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨åï¼Œå®¢æˆ·ç«¯é€šè¿‡åŠ¨æ€ä¸‹è½½èµ„æºæ–‡ä»¶æ¥æ‰§è¡ŒåŠ¨ç”»ã€‚è¿™æ ·ä¸Šçº¿æ–°çš„ç¤¼ç‰©ï¼Œåªéœ€è¦å°†èµ„æºæ–‡ä»¶ä¸Šä¼ ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å‘ç‰ˆå®Œå…¨å¯ä»¥æ‰§è¡Œæ–°ç¤¼ç‰©çš„åŠ¨ç”»æ•ˆæœã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><img title="æµç¨‹å›¾" src="http://images.imliujun.com/static/images/Lottie/Lottie_9.jpeg">  <h2 id="ä½¿ç”¨è¯¦è§£"><a href="#ä½¿ç”¨è¯¦è§£" class="headerlink" title="ä½¿ç”¨è¯¦è§£"></a>ä½¿ç”¨è¯¦è§£</h2><p>æœ¬æ–‡å°±ä»¥ç›´æ’­é—´æ’­æ”¾åŠ¨ç”»ä¸ºä¾‹å­æ¥è®²è§£å…·ä½“çš„å®ç°æ–¹æ¡ˆï¼Œå…ˆçœ‹ä¸‹åŠ¨ç”»æ•ˆæœï¼š</p><img title="åŠ¨ç”»æ•ˆæœ" src="http://images.imliujun.com/static/images/Lottie/Lottie_1.gif">  <p>ç›´æ’­è½¯ä»¶çš„å¤§ç¤¼ç‰©ä¸€èˆ¬éƒ½æ˜¯é£æœºã€è·‘è½¦ã€èˆªæ¯ã€èŠ±ç“£é›¨ç­‰ï¼Œè¿™äº›ç‰©å“ä¸æ˜¯ç®€å•çš„çº¿æ¡ã€è‰²å—æ‰€èƒ½ç»˜åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨å›¾ç‰‡æ–‡ä»¶æ¥å®ç°åŠ¨ç”»æ•ˆæœã€‚<br>å¯¼å‡ºçš„åŠ¨ç”»èµ„æºåŒ…æ‹¬ä¸€ä¸ª json æ–‡ä»¶å’Œä¸€ç»„å›¾ç‰‡æ–‡ä»¶ï¼š</p><img title="èµ„æºæ–‡ä»¶ç›®å½•" src="http://images.imliujun.com/static/images/Lottie/Lottie_2.jpg"><p>å°†è¿™äº›æ–‡ä»¶æ‰“æˆå‹ç¼©åŒ…ä¸Šä¼ åˆ°åå°ï¼Œå®¢æˆ·ç«¯ä¸‹è½½å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œä½¿ç”¨ Lottie åŠ è½½æœ¬åœ°èµ„æºæ‰§è¡ŒåŠ¨ç”»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">File jsonFile = <span class="keyword">new</span> File(giftDir, <span class="string">"79.json"</span>);</span><br><span class="line">File imagesDir = <span class="keyword">new</span> File(giftDir, <span class="string">"images"</span>);</span><br><span class="line">FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (jsonFile.exists()) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fis = <span class="keyword">new</span> FileInputStream(jsonFile);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (fis == <span class="keyword">null</span> || !imagesDir.exists()) &#123;</span><br><span class="line">    showLocalAnimation(gift);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">final</span> String absolutePath = imagesDir.getAbsolutePath();</span><br><span class="line"><span class="comment">//æä¾›ä¸€ä¸ªä»£ç†æ¥å£ä» SD å¡è¯»å– images ä¸‹çš„å›¾ç‰‡</span></span><br><span class="line">mLottieAnimationView.setImageAssetDelegate(<span class="keyword">new</span> ImageAssetDelegate() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">fetchBitmap</span><span class="params">(LottieImageAsset asset)</span> </span>&#123;</span><br><span class="line">        BitmapFactory.Options opts = <span class="keyword">new</span> BitmapFactory.Options();</span><br><span class="line">        opts.inScaled = <span class="keyword">true</span>;</span><br><span class="line">        opts.inDensity = <span class="number">160</span>;</span><br><span class="line">        <span class="keyword">return</span> BitmapFactory.decodeFile(absolutePath + File.separator +</span><br><span class="line">                asset.getFileName(), opts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//ä»æ–‡ä»¶æµä¸­åŠ è½½ json æ•°æ®</span></span><br><span class="line">LottieComposition.Factory.fromInputStream(<span class="keyword">this</span>, fis, <span class="keyword">new</span> OnCompositionLoadedListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompositionLoaded</span><span class="params">(LottieComposition composition)</span> </span>&#123;</span><br><span class="line">        mLottieAnimationView.setVisibility(View.VISIBLE);</span><br><span class="line">        mLottieAnimationView.setComposition(composition);</span><br><span class="line">        mLottieAnimationView.playAnimation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…³é”®çš„ä»£ç å°±æ˜¯è®¾ç½®å›¾ç‰‡èµ„æºä»£ç†ï¼Œå» SD å¡è§£æå›¾ç‰‡æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“è¯¥è§£æå“ªä¸€å¼ å›¾ç‰‡å‘¢ï¼Ÿå’±ä»¬æ¥çœ‹çœ‹ json æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼š</p><img title="jsonæ–‡ä»¶" src="http://images.imliujun.com/static/images/Lottie/Lottie_7.jpg">  <p><code>assets</code> å­—æ®µæ˜¯å›¾ç‰‡èµ„æºçš„æ•°ç»„ï¼Œå…·ä½“çš„è§£æçš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">LottieImageAsset</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, String id, String fileName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">    <span class="keyword">this</span>.height = height;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Factory</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> LottieImageAsset <span class="title">newInstance</span><span class="params">(JSONObject imageJson)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LottieImageAsset(</span><br><span class="line">                  imageJson.optInt(<span class="string">"w"</span>),     <span class="comment">//width</span></span><br><span class="line">                  imageJson.optInt(<span class="string">"h"</span>),     <span class="comment">//height</span></span><br><span class="line">                  imageJson.optString(<span class="string">"id"</span>), <span class="comment">//id</span></span><br><span class="line">                  imageJson.optString(<span class="string">"p"</span>)   <span class="comment">//fileName</span></span><br><span class="line">               );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ ¹æ® <code>ImageAssetDelegate</code> ä»£ç†ç±»çš„ <code>fetchBitmap(LottieImageAsset asset)</code> æ–¹æ³•ä¸­çš„ <code>LottieImageAsset</code> å‚æ•°è·å–å½“å‰éœ€è¦è§£æçš„å›¾ç‰‡æ–‡ä»¶åï¼Œå» images æ–‡ä»¶å¤¹ä¸‹é¢è§£æå¯¹åº”çš„æ–‡ä»¶å°±OKå•¦ã€‚</p><p>è¿™å‡ è¡Œä»£ç å°±å®ç°äº†ä»SDå¡åŠ¨æ€åŠ è½½åŠ¨ç”»ï¼Œé‚£ä¹ˆè¿™æ ·å°±ç®—å®Œå·¥äº†å—ï¼Ÿçœ‹çœ‹ä¸Šé¢çš„åŠ¨ç”»æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ä»€ä¹ˆåœ°æ–¹ä¸å¯¹åŠ²ï¼Ÿå¥½å§ï¼Œä½œä¸ºä¸€ä¸ª Android è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œä¸€å®šè¦è®°ä½2ä¸ªå­— <strong>é€‚é…</strong> <strong>é€‚é…</strong> <strong>é€‚é…</strong></p><h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><p>åŠ¨ç”»æ˜¯å…¨å±çš„æ•ˆæœï¼Œå°å¹½çµä¹Ÿæ˜¯ä»å±å¹•å¤–é£è¿›æ¥çš„æ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆèƒŒæ™¯å›¾ç¦»å±å¹•ä¸¤è¾¹æœ‰ç©ºéš™å‘¢ï¼Ÿ</p><img title="æ²¡æœ‰å±å¹•é€‚é…çš„æ•ˆæœ" src="http://images.imliujun.com/static/images/Lottie/Lottie_4.jpg"><p>å†æ¥çœ‹çœ‹è¿™ä¸ªåŠ¨å›¾ï¼Œ<strong>ä¸ºä»€ä¹ˆéšè—è™šæ‹ŸæŒ‰é”®å°±å…¨å±äº†å‘¢ï¼Ÿ</strong></p><img title="éšè—è™šæ‹ŸæŒ‰é”®" src="http://images.imliujun.com/static/images/Lottie/Lottie_5.gif"><p>å†æ¥çœ‹çœ‹ json æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼š</p><img title="jsonæ–‡ä»¶" src="http://images.imliujun.com/static/images/Lottie/Lottie_7.jpg"><p>èƒŒæ™¯å›¾çš„å®½é«˜å’Œç”»å¸ƒçš„å®½é«˜æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰è™šæ‹ŸæŒ‰é”®çš„æ—¶å€™èƒŒæ™¯å›¾å°±ä¸å…¨å±å‘¢ï¼ŸåŸå› å…¶å®å¾ˆç®€å•ï¼Œæ¥çœ‹ä¸€ä¸‹ Lottie æ˜¯æ€ä¹ˆè§£æ json æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> LottieComposition <span class="title">fromJsonSync</span><span class="params">(Resources res, JSONObject json)</span> </span>&#123;</span><br><span class="line">      Rect bounds = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">float</span> scale = res.getDisplayMetrics().density;</span><br><span class="line">      <span class="keyword">int</span> width = json.optInt(<span class="string">"w"</span>, -<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">int</span> height = json.optInt(<span class="string">"h"</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (width != -<span class="number">1</span> &amp;&amp; height != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> scaledWidth = (<span class="keyword">int</span>) (width * scale);</span><br><span class="line">        <span class="keyword">int</span> scaledHeight = (<span class="keyword">int</span>) (height * scale);</span><br><span class="line">        bounds = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, scaledWidth, scaledHeight);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">long</span> startFrame = json.optLong(<span class="string">"ip"</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">long</span> endFrame = json.optLong(<span class="string">"op"</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">int</span> frameRate = json.optInt(<span class="string">"fr"</span>, <span class="number">0</span>);</span><br><span class="line">      LottieComposition composition =</span><br><span class="line">          <span class="keyword">new</span> LottieComposition(bounds, startFrame, endFrame, frameRate, scale);</span><br><span class="line">      JSONArray assetsJson = json.optJSONArray(<span class="string">"assets"</span>);</span><br><span class="line">      parseImages(assetsJson, composition);</span><br><span class="line">      parsePrecomps(assetsJson, composition);</span><br><span class="line">      parseLayers(json, composition);</span><br><span class="line">      <span class="keyword">return</span> composition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æå‡ºäº†åŠ¨ç”»çš„å®½é«˜ã€å¸§ç‡ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œå°†è§£æå‡ºæ¥çš„å®½é«˜ä¹˜ä¸Šäº†å±å¹•çš„åƒç´ å¯†åº¦ï¼Œç„¶åè®¾ç½®æ¸²æŸ“åŒºåŸŸçš„è¾¹ç•Œï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œæœ¬æ–‡å°†å…¶ç§°ä¸ºç”»å¸ƒã€‚æˆ‘è¿™å°æ‰‹æœºæ˜¯ 1080P çš„åˆ†è¾¨ç‡ï¼Œdensity = 3ï¼ŒscaledWidth = 2250ï¼ŒscaledHeight = 4002ï¼Œç°åœ¨ç¼©æ”¾åçš„ç”»å¸ƒå®½é«˜æ¯”æ‰‹æœºå±å¹•å¤§äº†å¤ªå¤šï¼Œå¦‚æœåŠ¨ç”»åœ¨è¿™ç§å°ºå¯¸ä¸‹è¿›è¡Œæ¸²æŸ“è‚¯å®šä¸è¡Œã€‚æ‰€ä»¥ LottieAnimationView åŠ è½½ Composition æ—¶åˆ¤æ–­äº†ç”»å¸ƒçš„å®½é«˜å¦‚æœå¤§äºæ‰‹æœºå±å¹•çš„å®½é«˜å°±è¿›è¡Œç­‰æ¯”ä¾‹ç¼©å°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setComposition</span><span class="params">(@NonNull LottieComposition composition)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L.DBG) &#123;</span><br><span class="line">      Log.v(TAG, <span class="string">"Set Composition \n"</span> + composition);</span><br><span class="line">    &#125;</span><br><span class="line">    lottieDrawable.setCallback(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> isNewComposition = lottieDrawable.setComposition(composition);</span><br><span class="line">    <span class="keyword">if</span> (!isNewComposition) &#123;</span><br><span class="line">      <span class="comment">// We can avoid re-setting the drawable, and invalidating the view, since the composition</span></span><br><span class="line">      <span class="comment">// hasn't changed.</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡ç‚¹åœ¨è¿™é‡Œï¼Œæ ¹æ®å±å¹•å®½é«˜å¯¹ç”»å¸ƒè¿›è¡Œç­‰æ¯”ä¾‹ç¼©æ”¾</span></span><br><span class="line">    <span class="keyword">int</span> screenWidth = Utils.getScreenWidth(getContext());</span><br><span class="line">    <span class="keyword">int</span> screenHeight = Utils.getScreenHeight(getContext());</span><br><span class="line">    <span class="keyword">int</span> compWidth = composition.getBounds().width();</span><br><span class="line">    <span class="keyword">int</span> compHeight = composition.getBounds().height();</span><br><span class="line">    <span class="comment">//å¦‚æœç”»å¸ƒçš„å®½é«˜å¤§äºå±å¹•å®½é«˜ï¼Œè®¡ç®—ç¼©æ”¾æ¯”</span></span><br><span class="line">    <span class="keyword">if</span> (compWidth &gt; screenWidth ||</span><br><span class="line">        compHeight &gt; screenHeight) &#123;</span><br><span class="line">      <span class="keyword">float</span> xScale = screenWidth / (<span class="keyword">float</span>) compWidth;</span><br><span class="line">      <span class="keyword">float</span> yScale = screenHeight / (<span class="keyword">float</span>) compHeight;</span><br><span class="line">      <span class="comment">//æŒ‰æ¯”ä¾‹ç¼©å°</span></span><br><span class="line">      setScale(Math.min(xScale, yScale));</span><br><span class="line">      Log.w(L.TAG, String.format(</span><br><span class="line">          <span class="string">"Composition larger than the screen %dx%d vs %dx%d. Scaling down."</span>,</span><br><span class="line">          compWidth, compHeight, screenWidth, screenHeight));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// If you set a different composition on the view, the bounds will not update unless</span></span><br><span class="line">    <span class="comment">// the drawable is different than the original.</span></span><br><span class="line">    setImageDrawable(<span class="keyword">null</span>);</span><br><span class="line">    setImageDrawable(lottieDrawable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.composition = composition;</span><br><span class="line"></span><br><span class="line">    requestLayout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®—å‡ºå®½å’Œé«˜çš„ç¼©æ”¾æ¯”åï¼Œä¸ºäº†è®©ç”»å¸ƒå°äºå±å¹•ï¼Œæ‰€ä»¥å–è¾ƒå°çš„ä¸€ä¸ªæ¯”ä¾‹ï¼Œè°ƒç”¨ setScale æ–¹æ³•å°†ç¼©æ”¾æ¯”è®¾ç½®åˆ° lottieDrawable ä¸Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScale</span><span class="params">(<span class="keyword">float</span> scale)</span> </span>&#123;</span><br><span class="line">    lottieDrawable.setScale(scale);</span><br><span class="line">    <span class="keyword">if</span> (getDrawable() == lottieDrawable) &#123;</span><br><span class="line">      setImageDrawable(<span class="keyword">null</span>);</span><br><span class="line">      setImageDrawable(lottieDrawable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>lottieDrawable çš„ setScale æ–¹æ³•ä¿å­˜äº†ç¼©æ”¾æ¯”ï¼Œå¹¶ä¸”æ›´æ–°äº†ç»˜åˆ¶çš„çŸ©å½¢èŒƒå›´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScale</span><span class="params">(<span class="keyword">float</span> scale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.scale = scale;</span><br><span class="line">    updateBounds();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°çŸ©å½¢çš„èŒƒå›´æ˜¯æ ¹æ®ç”»å¸ƒçš„å®½é«˜è¿›è¡Œäº†ç­‰æ¯”ä¾‹çš„ç¼©æ”¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateBounds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (composition == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setBounds(<span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">int</span>) (composition.getBounds().width() * scale),</span><br><span class="line">        (<span class="keyword">int</span>) (composition.getBounds().height() * scale));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç”»å¸ƒè¢«ç¼©æ”¾äº†ï¼Œç„¶è€ŒèƒŒæ™¯å›¾å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹ lottieDrawable çš„ç»˜åˆ¶ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(@NonNull Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (compositionLayer == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    matrix.reset();</span><br><span class="line">    matrix.preScale(scale, scale);</span><br><span class="line">    compositionLayer.draw(canvas, matrix, alpha);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>lottieDrawable åœ¨ç»˜åˆ¶çš„æ—¶å€™å¯¹ matrix è®¾ç½®äº†ç¼©æ”¾æ¯”ï¼Œç„¶åè°ƒç”¨äº† compositionLayer å»è¿›è¡Œå…·ä½“çš„ç»˜åˆ¶ã€‚è¿™ä¸ª compositionLayer å°±æ˜¯æ‰€æœ‰å›¾å±‚çš„ä¸€ä¸ªç»„åˆï¼Œå®ƒæœ‰ä¸€ä¸ª<code>List&lt;BaseLayer&gt; layers</code>å±æ€§ï¼Œ è¿™ä¸ªå±æ€§å°±æ˜¯ json æ–‡ä»¶é‡Œé¢çš„<code>layers</code>èŠ‚ç‚¹è§£æå‡ºæ¥çš„å›¾å±‚åˆ—è¡¨ï¼Œæ¯ä¸ªå›¾å±‚ä¸­é—´è¿˜åŒ…å«ä¸€äº›å±æ€§åŠ¨ç”»ã€‚<code>compositionLayer.draw(canvas, matrix, alpha)</code>æ–¹æ³•ä¸­ä¸»è¦è°ƒç”¨äº† drawLayer æŠ½è±¡æ–¹æ³•ç”±å›¾å±‚çš„å…·ä½“å®ç°ç±»æ‰§è¡Œç»˜åˆ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawLayer</span><span class="params">(Canvas canvas, Matrix parentMatrix, <span class="keyword">int</span> parentAlpha)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = layers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">      layers.get(i).draw(canvas, parentMatrix, parentAlpha);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° CompositionLayer ç±»çš„ drawLayer æ–¹æ³•éå† layers é›†åˆè¿›è¡Œå¾ªç¯ç»˜åˆ¶ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨å›¾ç‰‡æ–‡ä»¶åšçš„åŠ¨ç”»ï¼Œå¯¹åº”çš„ Layer å®ç°ç±»ä¸º ImageLayerã€‚ çœ‹ä¸‹ ImageLayer çš„ç»˜åˆ¶æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawLayer</span><span class="params">(@NonNull Canvas canvas, Matrix parentMatrix, <span class="keyword">int</span> parentAlpha)</span> </span>&#123;</span><br><span class="line">    Bitmap bitmap = getBitmap();</span><br><span class="line">    <span class="keyword">if</span> (bitmap == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    paint.setAlpha(parentAlpha);</span><br><span class="line">    canvas.save();</span><br><span class="line">    canvas.concat(parentMatrix);</span><br><span class="line">    src.set(<span class="number">0</span>, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight());</span><br><span class="line">    dst.set(<span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">int</span>) (bitmap.getWidth() * density), (<span class="keyword">int</span>) (bitmap.getHeight() * density));</span><br><span class="line">    canvas.drawBitmap(bitmap, src, dst , paint);</span><br><span class="line">    canvas.restore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getBitmap() æ–¹æ³•ä¼šè°ƒç”¨åˆ°ä¸€å¼€å§‹è®¾ç½®çš„ä»£ç†ç±» ImageAssetDelegate ï¼Œä» SD å¡åŠ è½½å›¾ç‰‡ã€‚  </p><p>ä»£ç ä¸­è°ƒç”¨äº† canvas çš„<code>save</code>ã€<code>restore</code>æ–¹æ³•æ¥è¿›è¡Œå›¾å±‚çš„å åŠ ç»˜åˆ¶ï¼Œä» lottieDrawable çš„<code>draw</code>æ–¹æ³•ä¼ é€’ä¸‹æ¥çš„<code>matrix</code>ç”¨åˆ°äº†<code>concat</code>æ–¹æ³•ä¸Šï¼Œå¯¹ bitmap è¿›è¡Œäº†ç­‰æ¯”ç¼©æ”¾ã€‚</p><p>æ•´ä¸ªæµç¨‹è·‘ä¸‹æ¥ï¼ŒLottie åº“çš„åŠ¨ç”»æ¸²æŸ“æœºåˆ¶å·²ç»åŸºæœ¬äº†è§£ï¼ŒèƒŒæ™¯å›¾æ²¡æœ‰å…¨å±å±•ç¤ºçš„åŸå› å¦‚ä¸‹ï¼š</p><p><strong>èƒŒæ™¯å›¾çš„é•¿å®½æ¯”æ˜¯ 16 : 9ï¼Œæ‰‹æœºå±å¹•çš„é•¿å®½æ¯”ä¹Ÿæ˜¯ 16 : 9ï¼Œä½†æ˜¯å› ä¸ºåº•éƒ¨çš„è™šæ‹ŸæŒ‰é”®å äº†ä¸€éƒ¨åˆ†çš„é«˜åº¦ï¼Œå±å¹•å¯ç”¨ç©ºé—´çš„é•¿å®½æ¯”å¤§çº¦ä¸º 3 : 2ï¼Œæ‰€ä»¥å¯¼è‡´èƒŒæ™¯å›¾ä¸èƒ½é“ºæ»¡å±å¹•</strong></p><h2 id="å…¨å±é€‚é…"><a href="#å…¨å±é€‚é…" class="headerlink" title="å…¨å±é€‚é…"></a>å…¨å±é€‚é…</h2><p>åŠ¨ç”»ä¸èƒ½å…¨å±æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ‰‹æœºé•¿å®½æ¯”å’Œç”»å¸ƒçš„é•¿å®½æ¯”æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯çŠ¶æ€æ ã€å¯¼èˆªæ å äº†å±å¹•ä¸€éƒ¨åˆ†ç©ºé—´å¯¼è‡´ä¸èƒ½å…¨å±ï¼Œä½¿ç”¨æ–¹æ¡ˆä¸€å¯ä»¥è§£å†³é—®é¢˜ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯æ‰‹æœºå±å¹•é•¿å®½æ¯”å’Œç”»å¸ƒçš„é•¿å®½æ¯”å°±æ˜¯ä¸ä¸€æ ·ï¼Œæ¯•ç«Ÿ Android æœºå‹è¿™ä¹ˆå¤šï¼Œæœ‰å‡ å°å¥‡è‘©æ‰‹æœºå¾ˆæ­£å¸¸ï¼Œé‚£ä¹ˆä½¿ç”¨æ–¹æ¡ˆäºŒå¯ä»¥å®ç°å…¨å±ã€‚</p><h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h3><p>åœ¨æ‰§è¡ŒåŠ¨ç”»çš„ç•Œé¢éšè—è™šæ‹ŸæŒ‰é”®ï¼Œæˆ–è€…å°†è™šæ‹ŸæŒ‰é”®è®¾ç½®ä¸ºé€æ˜æµ®åœ¨å¸ƒå±€ä¸Šé¢ï¼Œè¿™æ ·å±å¹•çš„é•¿å®½æ¯”å’Œç”»å¸ƒçš„é•¿å®½æ¯”ä¸€æ ·å°±æ²¡æœ‰é—®é¢˜ã€‚ç›®å‰å¸‚é¢ä¸Šçš„æ‰‹æœºåŸºæœ¬ä¸Šéƒ½æ˜¯ 720Pã€1080Pã€2K ç­‰åˆ†è¾¨ç‡ï¼Œè¿™äº›åˆ†è¾¨ç‡éƒ½æ˜¯ 16 : 9 çš„å°ºå¯¸ã€‚</p><p>çŠ¶æ€æ å’Œè™šæ‹ŸæŒ‰é”®é€æ˜æ‚¬æµ®åœ¨å¸ƒå±€ä¸Šé¢ï¼Œè®¾ç½®æ ·å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Theme"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowTranslucentStatus"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowTranslucentNavigation"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éšè—è™šæ‹ŸæŒ‰é”®é€šè¿‡ä»£ç è®¾ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Window window = getWindow();</span><br><span class="line"><span class="keyword">int</span> visibility = View.SYSTEM_UI_FLAG_HIDE_NAVIGATION |</span><br><span class="line">                View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |</span><br><span class="line">                View.SYSTEM_UI_FLAG_LAYOUT_STABLE |</span><br><span class="line">                View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION;</span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">    window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</span><br><span class="line">    window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</span><br><span class="line">    window.setStatusBarColor(ContextCompat</span><br><span class="line">                    .getColor(getActivity(), android.R.color.transparent));</span><br><span class="line">    visibility |= View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">    window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</span><br><span class="line">    visibility |= View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY;</span><br><span class="line">&#125;</span><br><span class="line">window.getDecorView().setSystemUiVisibility(visibility);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»£ç éšè—è™šæ‹ŸæŒ‰é”®éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼š<strong>ç•Œé¢çš„åˆ‡æ¢ä¼šå¯¼è‡´ setSystemUiVisibility() çš„è®¾ç½®è¢«æ¸…ç©ºï¼Œæœ€å¥½æ˜¯åœ¨ onResume() æˆ–è€… onWindowFocusChanged() æ–¹æ³•ä¸­è¿›è¡Œè®¾ç½®ã€‚</strong></p><h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h3><p>å¦‚æœè¦é€‚é…å…¶ä»–é•¿å®½æ¯”çš„å±å¹•ï¼Œå’‹åŠå‘¢ï¼Ÿä¸¤è¡Œä»£ç è§£å†³é—®é¢˜ï¼Œåªä¸è¿‡å›¾ç‰‡æœ‰ä¸€éƒ¨åˆ†ä¼šè¢«è£å‰ªã€‚è®¾ç½®æ§ä»¶çš„å®½é«˜ä¸º<code>match_parent</code>ï¼Œè®¾ç½®<code>android:scaleType</code>ä¸º<code>centerCrop</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.airbnb.lottie.LottieAnimationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/lottieAnimationView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Lottie å‘å¸ƒæ‰å‡ ä¸ªæœˆï¼Œå¾ˆå¤šåŠŸèƒ½è¿˜ä¸å¤Ÿå®Œå–„ï¼Œç¼“å­˜æœºåˆ¶ä¹Ÿæ¯”è¾ƒå¼±ï¼Œåƒè¿™ç§ä» SD å¡åŠ¨æ€åŠ è½½çš„æ–¹å¼ï¼Œéœ€è¦è‡ªå·±å»å®ç°ç¼“å­˜é€»è¾‘ã€‚ä½†æ˜¯è¿™ç‚¹å°ç‘•ç–µæ©ç›–ä¸äº†ç‰›é€¼çš„äº‹å®ï¼Œå°±ç›®å‰è¿™ä¸ªéœ€æ±‚æ¥è¯´ï¼Œå·²ç»å¤§å¤§çš„é™ä½äº†å¼€å‘æˆæœ¬ã€‚åªä¸è¿‡è®¾è®¡å¸ˆä»¬éœ€è¦å¥½å¥½ç»ƒç»ƒ AE äº†ï¼ŒåŠ¨ç”»ç‚«ä¸ç‚«å°±çœ‹è®¾è®¡å¸ˆç»™ä¸ç»™åŠ›å•¦ğŸ˜†ğŸ˜†</p><p>æœ¬æ–‡æ˜¯ä½œè€…çš„å¤„å¥³ä½œï¼Œå¦‚æœå¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œç»™äºˆä½œè€…æ›´å¤šçš„åˆ›ä½œåŠ¨åŠ›ï¼Œæä¾›æ›´å¥½çš„ä½œå“ç»™å¤§å®¶ã€‚  </p><p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img title="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿" src="http://images.imliujun.com/static/images/wx_qrcode.png"></p>]]></content>
    
    <summary type="html">
    
      Lottieï¼Œè½»æ¾å®ç°ç‚«é…·åŠ¨ç”»ï¼Œè®© app åŠ è½½åŠ¨ç”»åƒåŠ è½½å›¾ç‰‡ä¸€æ ·ç®€å•ã€‚å‡ åˆ†é’Ÿæ—¶é—´è®©ä½ å­¦ä¼šåŠ¨æ€åŠ è½½èµ„æºå®ç°ç‚«é…·ç¤¼ç‰©åŠ¨ç”»ï¼Œå®Œç¾é€‚é…å®‰å“å„æœºå‹ã€‚
    
    </summary>
    
      <category term="Android" scheme="http://www.imliujun.com/categories/Android/"/>
    
    
      <category term="Lottie" scheme="http://www.imliujun.com/tags/Lottie/"/>
    
      <category term="ç›´æ’­" scheme="http://www.imliujun.com/tags/%E7%9B%B4%E6%92%AD/"/>
    
      <category term="åŠ¨æ€åŠ è½½" scheme="http://www.imliujun.com/tags/%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/"/>
    
      <category term="ç¤¼ç‰©" scheme="http://www.imliujun.com/tags/%E7%A4%BC%E7%89%A9/"/>
    
      <category term="åŠ¨ç”»" scheme="http://www.imliujun.com/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://www.imliujun.com/hello-world.html"/>
    <id>http://www.imliujun.com/hello-world.html</id>
    <published>2015-12-10T10:22:58.000Z</published>
    <updated>2017-06-28T06:50:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;http://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;http://hexo.io
      
    
    </summary>
    
    
  </entry>
  
</feed>
