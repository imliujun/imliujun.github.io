title: Lottieåº“å®ç°ç›´æ’­ç¤¼ç‰©åŠ¨ç”»
tags: Lottie ç›´æ’­ åŠ¨æ€åŠ è½½ ç¤¼ç‰© åŠ¨ç”»
date: 2017-04-25 07:27:11
categories:
---

[Lottie](https://github.com/airbnb/lottie-android) åº“æˆ‘å°±ä¸ä»‹ç»äº†ï¼Œä¸äº†è§£çš„å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« [Airbnb å¼€æºç‚«é…·åŠ¨ç”»åº“ Lottieï¼ˆè¯‘ï¼‰ï¼çœ‹çœ‹ Airbnb çš„å·¥ç¨‹å¸ˆæ€ä¹ˆè¯´](https://juejin.im/entry/589ba3fc128fe1005801704b)

`Lottie æ”¯æŒ Androidã€iOSã€React Native å¹³å°ï¼Œæ”¯æŒå®æ—¶æ¸²æŸ“ After Effects åŠ¨ç”»ï¼Œä½¿å¾— app ä¸­ä½¿ç”¨åŠ¨ç”»å¯ä»¥åƒä½¿ç”¨é™æ€èµ„æºä¸€æ ·ç®€å•ã€‚`

## ä½¿ç”¨åœºæ™¯

ä¼—æ‰€å‘¨çŸ¥ï¼Œåšç›´æ’­è½¯ä»¶è‚¯å®šå°‘ä¸äº†å„ç§ç¤¼ç‰©çš„åŠ¨ç”»æ•ˆæœï¼Œå½“ä¸Šçº¿æ–°çš„ç¤¼ç‰©æ—¶ï¼Œä¸ä»… Androidã€ios éœ€è¦å®ç°æ–°çš„åŠ¨ç”»æ•ˆæœï¼Œè¿˜å¾ˆéš¾å…¼å®¹è€ç‰ˆæœ¬ã€‚ç°åœ¨æœ‰äº† Lottieï¼Œå¯ä»¥è®©è®¾è®¡å¸ˆä½¿ç”¨ After Effects è¿›è¡ŒåŠ¨ç”»è®¾è®¡ï¼Œé€šè¿‡ Bodymovin æ’ä»¶å¯¼å‡º json æ–‡ä»¶ï¼Œå°†åŠ¨ç”»èµ„æºæ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨åï¼Œå®¢æˆ·ç«¯é€šè¿‡åŠ¨æ€ä¸‹è½½èµ„æºæ–‡ä»¶æ¥æ‰§è¡ŒåŠ¨ç”»ã€‚è¿™æ ·ä¸Šçº¿æ–°çš„ç¤¼ç‰©ï¼Œåªéœ€è¦å°†èµ„æºæ–‡ä»¶ä¸Šä¼ ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å‘ç‰ˆå®Œå…¨å¯ä»¥æ‰§è¡Œæ–°ç¤¼ç‰©çš„åŠ¨ç”»æ•ˆæœã€‚

## ä½¿ç”¨è¯¦è§£

å…ˆçœ‹ä¸‹åŠ¨ç”»æ•ˆæœï¼š

![å¹½çµåŠ¨ç”»æ•ˆæœ](https://mmbiz.qlogo.cn/mmbiz_gif/5MJZPMAX957mRHzicibvoEHbIUichBfvMKHRMwCFBzOQsZSLPY2GibsKkUF0iaVvnXicOz0uia7EOGDAost6ibib7ialQGiaA/0?wx_fmt=gif)

å…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹åŠ¨ç”»èµ„æºæ–‡ä»¶çš„ç»“æ„ã€‚ç”±äºç›´æ’­é—´é€å‡ºçš„å¤§ç¤¼ç‰©ä¸€èˆ¬éƒ½æ˜¯é£æœºã€è·‘è½¦ã€èˆªæ¯ã€èŠ±ç“£é›¨ç­‰ç‰©å“ï¼Œè¿™äº›ç‰©å“ä¸æ˜¯ç®€å•çš„çº¿æ¡ã€è‰²å—èƒ½å¤Ÿç»˜åˆ¶çš„å‡ºæ¥ï¼Œæ‰€ä»¥ä½¿ç”¨å›¾ç‰‡æ–‡ä»¶æ¥å®ç°åŠ¨ç”»æ•ˆæœã€‚

è¿™æ ·ä¸€æ¥è®¾è®¡å¸ˆå¯¼å‡ºæ¥çš„åŠ¨ç”»èµ„æºåŒ…æ‹¬ä¸€ä¸ª json æ–‡ä»¶å’Œä¸€ç»„å›¾ç‰‡æ–‡ä»¶ï¼š

![èµ„æºæ–‡ä»¶ç›®å½•](https://mmbiz.qlogo.cn/mmbiz_png/5MJZPMAX957mRHzicibvoEHbIUichBfvMKH1QICgdxYRibg3k2Q15rhPtamoxD2Ae59XtjtQ6QxAjweVhoCQic4nVWQ/0?wx_fmt=png)

å°†è¿™äº›æ–‡ä»¶æ‰“æˆå‹ç¼©åŒ…ä¸Šä¼ åˆ°åå°ï¼Œå®¢æˆ·ç«¯ä¸‹è½½å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œä½¿ç”¨ Lottie åŠ è½½æœ¬åœ°èµ„æºæ‰§è¡ŒåŠ¨ç”»ï¼š

```java
File jsonFile = new File(giftDir, "79.json");
File imagesDir = new File(giftDir, "images");
FileInputStream fis = null;
if (jsonFile.exists()) {
    try {
        fis = new FileInputStream(jsonFile);
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    }
}
if (fis == null || !imagesDir.exists()) {
    showLocalAnimation(gift);
    return;
}
final String absolutePath = imagesDir.getAbsolutePath();
//æä¾›ä¸€ä¸ªä»£ç†æ¥å£ä» SD å¡è¯»å– images ä¸‹çš„å›¾ç‰‡
mLottieAnimationView.setImageAssetDelegate(new ImageAssetDelegate() {
    @Override
    public Bitmap fetchBitmap(LottieImageAsset asset) {
        BitmapFactory.Options opts = new BitmapFactory.Options();
        opts.inScaled = true;
        opts.inDensity = 160;
        return BitmapFactory.decodeFile(absolutePath + File.separator +
                asset.getFileName(), opts);
    }
});
//ä»æ–‡ä»¶æµä¸­åŠ è½½ json æ•°æ®
LottieComposition.Factory.fromInputStream(this, fis, new OnCompositionLoadedListener() {
    @Override
    public void onCompositionLoaded(LottieComposition composition) {
        mLottieAnimationView.setVisibility(View.VISIBLE);
        mLottieAnimationView.setComposition(composition);
        mLottieAnimationView.playAnimation();
    }
});

```

å…³é”®çš„ä»£ç å°±æ˜¯è®¾ç½®å›¾ç‰‡èµ„æºä»£ç†ï¼Œå» SD å¡è§£æå›¾ç‰‡æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“è¯¥è§£æå“ªä¸€å¼ å›¾ç‰‡å‘¢ï¼Ÿå’±ä»¬æ¥çœ‹çœ‹ json æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼š

![jsonæ–‡ä»¶](https://mmbiz.qlogo.cn/mmbiz_jpg/5MJZPMAX957mRHzicibvoEHbIUichBfvMKHdKmIT8UtrmrKMwzrsCvbyb8micqOYj4BwXFR9Koq4rwZE8Ihpibc3e0g/0?wx_fmt=jpeg)

`assets` å­—æ®µæ˜¯å›¾ç‰‡èµ„æºçš„æ•°ç»„ï¼Œå…·ä½“çš„è§£æçš„æºç å¦‚ä¸‹ï¼š

```java
private LottieImageAsset(int width, int height, String id, String fileName) {
    this.width = width;
    this.height = height;
    this.id = id;
    this.fileName = fileName;
}

static class Factory {
    private Factory() {}

    static LottieImageAsset newInstance(JSONObject imageJson) {
        return new LottieImageAsset(
                  imageJson.optInt("w"),     //width
                  imageJson.optInt("h"),     //height
                  imageJson.optString("id"), //id
                  imageJson.optString("p")   //fileName
               );
    }
}
```

ç›´æ¥æ ¹æ® `ImageAssetDelegate` ä»£ç†ç±»çš„ `fetchBitmap(LottieImageAsset asset)` æ–¹æ³•ä¸­çš„ `LottieImageAsset` å‚æ•°è·å–å½“å‰éœ€è¦è§£æçš„å›¾ç‰‡æ–‡ä»¶åï¼Œå» images æ–‡ä»¶å¤¹ä¸‹é¢è§£æå¯¹åº”çš„æ–‡ä»¶å°±OKå•¦ã€‚

è¿™å‡ è¡Œä»£ç å°±å®ç°äº†ä»SDå¡åŠ¨æ€åŠ è½½åŠ¨ç”»ï¼Œé‚£ä¹ˆè¿™æ ·å°±ç®—å®Œå·¥äº†å—ï¼Ÿçœ‹çœ‹ä¸Šé¢çš„åŠ¨ç”»æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ä»€ä¹ˆåœ°æ–¹ä¸å¯¹åŠ²ï¼Ÿ  
å¥½å§ï¼Œä½œä¸ºä¸€ä¸ªAndroidè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œä¸€å®šè¦è®°ä½2ä¸ªå­— **é€‚é…** **é€‚é…** **é€‚é…**

## æºç è§£æ

åŠ¨ç”»æ˜¯å…¨å±çš„æ•ˆæœï¼Œå°å¹½çµä¹Ÿæ˜¯ä»å±å¹•å¤–é£è¿›æ¥çš„æ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆèƒŒæ™¯å›¾ç¦»å±å¹•ä¸¤è¾¹æœ‰ç©ºéš™å‘¢ï¼Ÿ

![æ²¡æœ‰é€‚é…](https://mmbiz.qlogo.cn/mmbiz_png/5MJZPMAX957mRHzicibvoEHbIUichBfvMKHXxiaFpU9EkWEM8NgVROH3Ia5OHl6vMj9xEoJqKnr3VmEXDJXtaJZic0g/0?wx_fmt=png)

å†æ¥çœ‹çœ‹è¿™ä¸ªåŠ¨å›¾ï¼Œ**ä¸ºä»€ä¹ˆéšè—è™šæ‹ŸæŒ‰é”®å°±å…¨å±äº†å‘¢ï¼Ÿ**

![éšè—è™šæ‹ŸæŒ‰é”®](https://mmbiz.qlogo.cn/mmbiz_gif/5MJZPMAX957mRHzicibvoEHbIUichBfvMKHfrsFSSYqOCKoXMoZficF2ibBoJRmJvgxgafA3e3ibw02nrY98IEvCoe1w/0?wx_fmt=gif)

å†æ¥çœ‹çœ‹ json æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼š

![jsonæ–‡ä»¶](https://mmbiz.qlogo.cn/mmbiz_jpg/5MJZPMAX957mRHzicibvoEHbIUichBfvMKHbvopnE0xKiaibxSU9QdNvES3WQBp2g46RO288PEovlavjAwW6uP6dDqg/0?wx_fmt=jpeg)

èƒŒæ™¯å›¾çš„å®½é«˜å’Œç”»å¸ƒçš„å®½é«˜æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰è™šæ‹ŸæŒ‰é”®çš„æ—¶å€™èƒŒæ™¯å›¾å°±ä¸å…¨å±å‘¢ï¼ŸåŸå› å…¶å®å¾ˆç®€å•ï¼ˆç„¶è€Œæ‰¾äº†åŠå¤©æ‰æ‰¾åˆ°åŸå› ğŸ˜…ï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç ï¼ŒLottieAnimationView åŠ è½½ Composition æ—¶åˆ¤æ–­äº†ç”»å¸ƒçš„å®½é«˜å¦‚æœå¤§äºæ‰‹æœºå±å¹•çš„å®½é«˜å°±è¿›è¡Œç­‰æ¯”ä¾‹ç¼©å°ï¼š

```java
public void setComposition(@NonNull LottieComposition composition) {
    if (L.DBG) {
      Log.v(TAG, "Set Composition \n" + composition);
    }
    lottieDrawable.setCallback(this);

    boolean isNewComposition = lottieDrawable.setComposition(composition);
    if (!isNewComposition) {
      // We can avoid re-setting the drawable, and invalidating the view, since the composition
      // hasn't changed.
      return;
    }
    //é‡ç‚¹åœ¨è¿™é‡Œï¼Œæ ¹æ®å±å¹•å®½é«˜å¯¹ç”»å¸ƒè¿›è¡Œç­‰æ¯”ä¾‹ç¼©æ”¾
    int screenWidth = Utils.getScreenWidth(getContext());
    int screenHeight = Utils.getScreenHeight(getContext());
    int compWidth = composition.getBounds().width();
    int compHeight = composition.getBounds().height();
    //å¦‚æœç”»å¸ƒçš„å®½é«˜å¤§äºå±å¹•å®½é«˜ï¼Œè®¡ç®—ç¼©æ”¾æ¯”
    if (compWidth > screenWidth ||
        compHeight > screenHeight) {
      float xScale = screenWidth / (float) compWidth;
      float yScale = screenHeight / (float) compHeight;
      //æŒ‰æ¯”ä¾‹ç¼©å°
      setScale(Math.max(xScale, yScale));
      Log.w(L.TAG, String.format(
          "Composition larger than the screen %dx%d vs %dx%d. Scaling down.",
          compWidth, compHeight, screenWidth, screenHeight));
    }


    // If you set a different composition on the view, the bounds will not update unless
    // the drawable is different than the original.
    setImageDrawable(null);
    setImageDrawable(lottieDrawable);

    this.composition = composition;

    requestLayout();
}
```

è®¡ç®—å‡ºç¼©æ”¾æ¯”åï¼Œè°ƒç”¨ setScale æ–¹æ³•å°†ç¼©æ”¾æ¯”è®¾ç½®åˆ° lottieDrawable ä¸Šï¼š

```java
public void setScale(float scale) {
    lottieDrawable.setScale(scale);
    if (getDrawable() == lottieDrawable) {
      setImageDrawable(null);
      setImageDrawable(lottieDrawable);
    }
}
```

lottieDrawable çš„ setScale æ–¹æ³•ä¿å­˜äº†ç¼©æ”¾æ¯”ï¼Œå¹¶ä¸”æ›´æ–°äº†ç»˜åˆ¶çš„çŸ©å½¢èŒƒå›´ï¼š

```java
public void setScale(float scale) {
    this.scale = scale;
    updateBounds();
}
```

è¿™é‡Œå¯ä»¥çœ‹åˆ°çŸ©å½¢çš„èŒƒå›´æ˜¯æ ¹æ®ç”»å¸ƒçš„å®½é«˜è¿›è¡Œäº†ç­‰æ¯”ä¾‹çš„ç¼©æ”¾

```java
private void updateBounds() {
    if (composition == null) {
      return;
    }
    setBounds(0, 0, (int) (composition.getBounds().width() * scale),
        (int) (composition.getBounds().height() * scale));
}
```

ç°åœ¨ç”»å¸ƒè¢«ç¼©æ”¾äº†ï¼Œç„¶è€ŒèƒŒæ™¯å›¾å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹ lottieDrawable çš„ç»˜åˆ¶ä»£ç ï¼š

```java
public void draw(@NonNull Canvas canvas) {
    if (compositionLayer == null) {
      return;
    }
    matrix.reset();
    matrix.preScale(scale, scale);
    compositionLayer.draw(canvas, matrix, alpha);
  }
```

ç»˜åˆ¶çš„æ—¶å€™å¯¹ matrix è®¾ç½®ç¼©æ”¾æ¯”ï¼Œç„¶åè°ƒç”¨äº† compositionLayer å»è¿›è¡Œå…·ä½“çš„ç»˜åˆ¶ï¼Œè¿™ä¸ª compositionLayer ä¸­æœ‰ä¸€ä¸ªé›†åˆ `private final List<BaseLayer> layers = new ArrayList<>();` å°±æ˜¯ json æ–‡ä»¶é‡Œé¢çš„ `layers` èŠ‚ç‚¹è§£æå‡ºæ¥çš„å›¾å±‚åˆ—è¡¨ï¼Œå…¶ä¸­è¿˜åŒ…å«ä¸€äº›å±æ€§åŠ¨ç”»ã€‚`compositionLayer.draw(canvas, matrix, alpha);` æ–¹æ³•ä¸­ä¸»è¦è°ƒç”¨äº† drawLayer æŠ½è±¡æ–¹æ³•ç”±å›¾å±‚çš„å…·ä½“å®ç°ç±»æ‰§è¡Œç»˜åˆ¶ï¼š

```java
void drawLayer(Canvas canvas, Matrix parentMatrix, int parentAlpha) {
    for (int i = layers.size() - 1; i >= 0 ; i--) {
      layers.get(i).draw(canvas, parentMatrix, parentAlpha);
    }
}
```

CompositionLayer ç±»æ˜¯å¤åˆå±‚ï¼Œéå† layers é›†åˆä¸€å±‚ä¸€å±‚çš„è¿›è¡Œç»˜åˆ¶ï¼Œè€Œæˆ‘ä»¬æ˜¯ä½¿ç”¨å›¾ç‰‡æ–‡ä»¶åšçš„åŠ¨ç”»ï¼Œå¯¹åº”çš„ Layer å®ç°ç±»ä¸º ImageLayerã€‚ æˆ‘ä»¬çœ‹ä¸‹ ImageLayer çš„ç»˜åˆ¶æ–¹æ³•ï¼š

```java
public void drawLayer(@NonNull Canvas canvas, Matrix parentMatrix, int parentAlpha) {
    Bitmap bitmap = getBitmap();
    if (bitmap == null) {
      return;
    }
    paint.setAlpha(parentAlpha);
    canvas.save();
    canvas.concat(parentMatrix);
    src.set(0, 0, bitmap.getWidth(), bitmap.getHeight());
    dst.set(0, 0, (int) (bitmap.getWidth() * density), (int) (bitmap.getHeight() * density));
    canvas.drawBitmap(bitmap, src, dst , paint);
    canvas.restore();
}
```

getBitmap() æ–¹æ³•ä¼šè°ƒç”¨åˆ°ä¸€å¼€å§‹è®¾ç½®çš„ä»£ç†ç±» ImageAssetDelegate ï¼Œè·å–åˆ°ä» SD å¡è¯»å–åˆ°çš„å›¾ç‰‡ã€‚  

çœ‹ä»£ç ä¸­è°ƒç”¨äº† canvas çš„ `save`ã€`restore` æ–¹æ³•æ¥è¿›è¡Œå›¾å±‚çš„å åŠ ç»˜åˆ¶ï¼ŒlottieDrawable çš„ `draw` æ–¹æ³•ä¼ é€’ä¸‹æ¥çš„ `matrix` ç”¨åˆ°äº† `concat` æ–¹æ³•ä¸Šï¼Œå¯¹ bitmap è¿›è¡Œäº†ç­‰æ¯”å‹ç¼©ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“ç”»å¸ƒå’Œ bitmap éƒ½æ ¹æ®å±å¹•çš„å®½é«˜è¿›è¡Œäº†ç­‰æ¯”ç¼©æ”¾ï¼Œè€Œæˆ‘ä»¬éšè—è™šæ‹ŸæŒ‰é”®æ—¶ï¼ŒèƒŒæ™¯å›¾ç‰‡ç¼©æ”¾çš„å¤§å°å’Œå±å¹•å®½é«˜æ˜¯å»åˆçš„ï¼Œæ˜¾ç¤ºè™šæ‹ŸæŒ‰é”®æ—¶ï¼ŒèƒŒæ™¯å›¾ç‰‡ç¼©æ”¾åçš„é«˜åº¦å’Œå±å¹•é«˜åº¦ä¸€æ ·ï¼Œä½†æ˜¯å®½åº¦æ¯”å±å¹•çš„å®½åº¦è¦å°ï¼Œæ‰€ä»¥ä¸¤è¾¹å°±æœ‰é—´è·ã€‚

å½’æ ¹ç»“åº•å°±æ˜¯ä¸€å¥è¯ï¼š
**èƒŒæ™¯å›¾çš„é•¿å®½æ¯”æ˜¯ 16 : 9ï¼Œæ‰‹æœºå±å¹•çš„é•¿å®½æ¯”ä¹Ÿæ˜¯ 16 : 9ï¼Œä½†æ˜¯å› ä¸ºåº•éƒ¨çš„è™šæ‹ŸæŒ‰é”®å äº†ä¸€éƒ¨åˆ†çš„é«˜åº¦ï¼Œå±å¹•çš„å¯ç”¨ç©ºé—´çš„é•¿å®½æ¯”å¤§çº¦ä¸º 3 : 2**
**16 : 9 çš„å›¾ç‰‡å†æ€ä¹ˆç­‰æ¯”ç¼©æ”¾ä¹Ÿä¸èƒ½é“ºæ»¡ 3 : 2 çš„å±å¹•å•Š**

## å…¨å±é€‚é…

å› ä¸ºç”»å¸ƒçš„é•¿å®½æ¯”æ˜¯ 16 : 9 ï¼Œé‚£ä¹ˆåªæœ‰åœ¨æ‰‹æœºåˆ†è¾¨ç‡ä¸æ˜¯ 16 : 9 æˆ–è€…å¸¦è™šæ‹ŸæŒ‰é”®çš„æ‰‹æœºä¸Šä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚

### æ–¹æ¡ˆä¸€

åœ¨æ‰§è¡ŒåŠ¨ç”»çš„ç•Œé¢éšè—è™šæ‹ŸæŒ‰é”®ï¼Œæˆ–è€…å°†è™šæ‹ŸæŒ‰é”®è®¾ç½®ä¸ºé€æ˜æµ®åœ¨å¸ƒå±€ä¸Šé¢ï¼Œè¿™æ ·å±å¹•çš„é•¿å®½æ¯”å’Œç”»å¸ƒçš„é•¿å®½æ¯”ä¸€æ ·å°±æ²¡æœ‰é—®é¢˜ã€‚ç›®å‰å¸‚é¢ä¸Šçš„æ‰‹æœºåŸºæœ¬ä¸Šéƒ½æ˜¯ 720Pã€1080Pã€2K ç­‰åˆ†è¾¨ç‡ï¼Œè¿™äº›åˆ†è¾¨ç‡éƒ½æ˜¯ 16 : 9 çš„å°ºå¯¸ã€‚

è®¾ç½®ä¸»é¢˜ï¼š

```xml
<style name="Theme">
        <item name="android:windowTranslucentStatus">true</item>
        <item name="android:windowTranslucentNavigation">true</item>
</style>
```

ä»£ç è®¾ç½®ï¼š

```java
Window window = getWindow();
int visibility = View.SYSTEM_UI_FLAG_LOW_PROFILE |
    View.SYSTEM_UI_FLAG_HIDE_NAVIGATION;
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
    window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);
    window.setStatusBarColor(ContextCompat.getColor(this, android.R.color.transparent));
    visibility |= View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |
                    View.SYSTEM_UI_FLAG_LAYOUT_STABLE |
                    View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY;
} else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
    window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    visibility |= View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY;
}
window.getDecorView().setSystemUiVisibility(visibility);
```

### æ–¹æ¡ˆäºŒ

å¦‚æœé“äº†å¿ƒè¦é€‚é…ä¸æ˜¯ 16 : 9 å±å¹•çš„æ‰‹æœºï¼Œé‚£ä¹ˆä¹Ÿæ˜¯èƒ½å¤Ÿå®ç°çš„ğŸ˜†ğŸ˜† å…ˆè§£æ JSONObject ç„¶åå¯¹æ¯”å±å¹•çš„é•¿å®½æ¯”å’Œç”»å¸ƒçš„é•¿å®½æ¯”ç›¸å·®è¶…è¿‡ 0.01ï¼Œå°±æ ¹æ®å±å¹•é•¿å®½æ¯”ä¿®æ”¹ç”»å¸ƒçš„é«˜åº¦ã€‚

```java
InputStream stream = null;
try {
    stream = getAssets().open("79.json");
    int size = stream.available();
    byte[] buffer = new byte[size];
    stream.read(buffer);
    String json = new String(buffer, "UTF-8");
    JSONObject jsonObject = new JSONObject(json);
    DisplayMetrics displayMetrics = new DisplayMetrics();
    WindowManager wm = (WindowManager) getApplicationContext().getSystemService(Context.WINDOW_SERVICE);
    wm.getDefaultDisplay().getMetrics(displayMetrics);
    float displayScaled = displayMetrics.heightPixels / (float) displayMetrics.widthPixels;
    int w = jsonObject.optInt("w");
    int h = jsonObject.optInt("h");
    float scaled = h / (float) w;
    if (Math.abs(displayScaled - scaled) > 0.01F) {
        jsonObject.put("h", (int) (w * displayScaled));
    }
    mLottieAnimationView.setAnimation(jsonObject);
    mLottieAnimationView.setImageAssetsFolder("images");
} catch (IOException e) {
    throw new IllegalStateException("Unable to find file.", e);
} catch (JSONException e) {
    throw new IllegalStateException("Unable to load JSON.", e);
} finally {
    closeQuietly(stream);
}
```
