<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="å¾®ä¿¡å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿"><title>çº¿ç¨‹å®‰å…¨å¼•èµ·çš„å½•éŸ³æ‚éŸ³ç”µæµéŸ³é—®é¢˜ | å¤§è„‘å¥½é¥¿</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-71377766-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">çº¿ç¨‹å®‰å…¨å¼•èµ·çš„å½•éŸ³æ‚éŸ³ç”µæµéŸ³é—®é¢˜</h1><a id="logo" href="/.">å¤§è„‘å¥½é¥¿</a><p class="description">è¡¥å……å¤§è„‘è¥å…»</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">çº¿ç¨‹å®‰å…¨å¼•èµ·çš„å½•éŸ³æ‚éŸ³ç”µæµéŸ³é—®é¢˜</h1><div class="post-meta">2018-03-22<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><a href="/recording1.html#SOHUCS" class="ds-thread-count"><span id="changyan_count_unit" style="font-size: 15px; color: #6E7173;">0</span><span> æ¡è¯„è®º</span></a><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js" async></script><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä»£ç æ’¸èµ·æ¥"><span class="toc-number">1.</span> <span class="toc-text">ä»£ç æ’¸èµ·æ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#éŸ³é¢‘æ•°æ®é‡‡é›†"><span class="toc-number">1.1.</span> <span class="toc-text">éŸ³é¢‘æ•°æ®é‡‡é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¯¹æ•°æ®è¿›è¡Œå¤„ç†"><span class="toc-number">1.2.</span> <span class="toc-text">å¯¹æ•°æ®è¿›è¡Œå¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è§£å†³æ‚éŸ³é—®é¢˜"><span class="toc-number">1.3.</span> <span class="toc-text">è§£å†³æ‚éŸ³é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">2.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><p>å‰æ®µæ—¶é—´å†™äº†ä¸€ä¸ªå½•éŸ³æ¨¡å—ï¼Œéœ€æ±‚æ˜¯ï¼šã€å½•éŸ³çš„æ—¶å€™å®æ—¶è¯­éŸ³è½¬æ–‡å­—ï¼Œå®æ—¶è®¡ç®—éŸ³é‡å¤§å°ï¼Œå®æ—¶è¿›è¡Œ MP3 è½¬ç ä¿å­˜ä¸ºæ–‡ä»¶ã€</p>
<p>é¦–å…ˆè¿›è¡Œéœ€æ±‚åˆ†æï¼Œç¡®å®šæŠ€æœ¯æ–¹æ¡ˆï¼š</p>
<ol>
<li>ä½¿ç”¨ AudioRecord è¿›è¡Œå½•éŸ³ï¼Œå®æ—¶è·å–åŸå§‹éŸ³é¢‘æ•°æ®</li>
<li>å°†éŸ³é¢‘æ•°æ®ä¼ é€’ç»™ç¬¬ä¸‰æ–¹è¯­éŸ³è½¬æ–‡å­— SDK è¿›è¡Œå¤„ç†</li>
<li>å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè®¡ç®—å‡ºéŸ³é‡å¤§å°</li>
<li>å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œ MP3 ç¼–ç </li>
<li>å°†ç¼–ç åçš„æ•°æ®å†™å…¥ MP3 æ–‡ä»¶</li>
</ol>
<p>æ•´ä¸ªä¸šåŠ¡æµç¨‹å¦‚ä¸Šï¼Œåªä¸è¿‡æˆ‘ä»¬ä¸ºäº†æ•ˆç‡å’Œè§£è€¦ï¼Œå°†æ¯ä¸ªå¤„ç†é€»è¾‘ç‹¬ç«‹å¼€æ¥ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶å‘å¤„ç†ã€‚</p>
<p>å…·ä½“æµç¨‹è§ä¸‹å›¾ï¼š</p>
<img title="å½•éŸ³æµç¨‹å›¾" src="http://images.imliujun.com/static/images/Recording/RecordingFlowChart.jpeg">
<h2 id="ä»£ç æ’¸èµ·æ¥"><a href="#ä»£ç æ’¸èµ·æ¥" class="headerlink" title="ä»£ç æ’¸èµ·æ¥"></a>ä»£ç æ’¸èµ·æ¥</h2><p>ä¸‹é¢çš„ä¼ªä»£ç å…¨éƒ¨ä½¿ç”¨ <code>kotlin</code> å±•ç¤ºï¼Œä¸ç†Ÿæ‚‰ <code>kotlin</code> æ²¡å…³ç³»ï¼Œåªéœ€è¦å…³æ³¨å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h3 id="éŸ³é¢‘æ•°æ®é‡‡é›†"><a href="#éŸ³é¢‘æ•°æ®é‡‡é›†" class="headerlink" title="éŸ³é¢‘æ•°æ®é‡‡é›†"></a>éŸ³é¢‘æ•°æ®é‡‡é›†</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»™ AudioRecord è¿›è¡Œå½•éŸ³é‡‡é›†ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> emitter: FlowableProcessor&lt;ShortArray&gt;</span><br><span class="line"><span class="keyword">val</span> isRecording = AtomicBoolean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = ShortArray(bufferSize)</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°†æ•°æ®ä½¿ç”¨ RxJava å‘é€å‡ºå»</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­è¯»å–åˆ°éŸ³é¢‘æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ RxJava å°†æ•°æ®å‘ä¸‹ä¼ é€’ã€‚<strong>ï¼ˆç”¨ä»€ä¹ˆä¼ é€’ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å°†æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€å±‚å»è¿›è¡Œå¤„ç†ï¼‰</strong></p>
<h3 id="å¯¹æ•°æ®è¿›è¡Œå¤„ç†"><a href="#å¯¹æ•°æ®è¿›è¡Œå¤„ç†" class="headerlink" title="å¯¹æ•°æ®è¿›è¡Œå¤„ç†"></a>å¯¹æ•°æ®è¿›è¡Œå¤„ç†</h3><p>å¤–éƒ¨æ¥æ”¶ RxJava çš„äº‹ä»¶ï¼Œå¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå¤„ç† <strong>ï¼ˆå†æ¬¡æé†’ï¼Œä¸éœ€è¦åœ¨æ„ç»†èŠ‚ï¼Œä¸»è¦å…³æ³¨ä¸šåŠ¡æµç¨‹ï¼‰</strong> ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ observeOnIo() æ“ä½œå°†çº¿ç¨‹åˆ‡æ¢åˆ° IO çº¿ç¨‹</span></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¡ç®—éŸ³é‡å¤§å°</span></span><br><span class="line">  <span class="keyword">val</span> volume = calVolume(it)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å°† ShortArray è½¬æ¢ä¸º ByteArray</span></span><br><span class="line">  <span class="keyword">var</span> pcmBuffer: ByteArray = ...</span><br><span class="line">  it.toByteArray(pcmBuffer)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¯­éŸ³è½¬æ–‡å­—</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">recorder?.start()?.observeOnIo()?.subscribe&#123; it:ShortArray -&gt;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶çš„ä»£ç å’Œå½•éŸ³é‡‡é›†çš„ä»£ç åˆ†åˆ«æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šäº†</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿›è¡Œ MP3 ç¼–ç </span></span><br><span class="line">  <span class="keyword">val</span> encode = mp3Encode(it)</span><br><span class="line">  <span class="keyword">if</span> (encode != <span class="literal">null</span> &amp;&amp; encode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// å°†ç¼–ç åçš„æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    mp3Stream.write(mp3Buffer, <span class="number">0</span>, encode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªä¸šåŠ¡æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œæˆ‘è‡ªå·±ä½¿ç”¨çš„æ‰‹æœºå’Œå…¬å¸æ‰€æœ‰çš„æµ‹è¯•æœºï¼Œè¯•å¬å½•åˆ¶å‡ºæ¥çš„ MP3 æ–‡ä»¶éƒ½æ²¡æœ‰é—®é¢˜ã€‚</p>
<p>å¼€å¼€å¿ƒå¿ƒçš„æ‰“åŒ…ï¼Œæµ‹è¯•ï¼Œä¸Šçº¿ã€‚</p>
<p>ç„¶åä½ æ‡‚çš„ï¼Œæœ‰äº›ç”¨æˆ·å½•åˆ¶å‡ºç°æ‚éŸ³ã€ç”µæµéŸ³ã€å£°éŸ³æ–­æ–­ç»­ç»­ã€‚ğŸ˜‚ğŸ˜‚</p>
<p>æœºæ™ºçš„åŒå­¦å¯èƒ½é€šè¿‡æ ‡é¢˜å·²ç»çŒœåˆ°äº†é—®é¢˜çš„åŸå› ï¼Œä½†æˆ‘å½“æ—¶æ²¡æœ‰æ‰‹æœºè¿›è¡Œé—®é¢˜å¤ç°ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯æ˜¯èŠ±äº†å¾ˆå¤§çš„åŠŸå¤«æ‰å®šä½åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p>
<h3 id="è§£å†³æ‚éŸ³é—®é¢˜"><a href="#è§£å†³æ‚éŸ³é—®é¢˜" class="headerlink" title="è§£å†³æ‚éŸ³é—®é¢˜"></a>è§£å†³æ‚éŸ³é—®é¢˜</h3><p>å› ä¸ºæˆ‘ä»¬åœ¨å½•éŸ³é‡‡é›†æ—¶å°†æ•°æ®è¯»å–åˆ° <code>buffer</code> å¯¹è±¡ä¸­ï¼Œç„¶åå°† <code>buffer</code> å¯¹è±¡é€šè¿‡ RxJava å‘ä¸‹ä¼ é€’ï¼Œå› ä¸º RxJava çš„ä¸‹æ¸¸éƒ½å¼€å¯äº†å¼‚æ­¥çº¿ç¨‹å»å¤„ç†äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨å½•éŸ³é‡‡é›†çš„æ­»å¾ªç¯ä¸­ä¸ç­‰å½“å‰çš„æ•°æ®è¿›è¡Œ MP3 ç¼–ç å®Œæ¯•å°±å¯¹ <code>buffer</code> å¯¹è±¡å†™å…¥æ–°é‡‡é›†åˆ°çš„éŸ³é¢‘æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ MP3 ç¼–ç å‡ºæ¥çš„éŸ³é¢‘æ•°æ®å°±è¢«æ±¡æŸ“äº†ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> emitter: FlowableProcessor&lt;ShortArray&gt;</span><br><span class="line"><span class="keyword">val</span> isRecording = AtomicBoolean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = ShortArray(bufferSize)</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="comment">// è¯»å–éŸ³é¢‘æ•°æ®åˆ° buffer ä¸­</span></span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°† buffer å‘é€å‡ºå»ï¼Œå› ä¸ºä¸‹æ¸¸æ˜¯å¼‚æ­¥å¤„ç†ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œæ¯•ç›´æ¥å¼€å§‹ä¸‹æ¬¡å¾ªç¯</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°† buffer æ•°æ® copy ä¸€ä»½è¿›è¡Œä¼ é€’ï¼Œè¿™æ ·å°±ä¸ä¼šä¿®æ”¹ä¸‹æ¸¸çš„æ•°æ®äº†</span></span><br><span class="line">emitter.onNext(buffer.copyOf())</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä½¿ç”¨ copy çš„æ–¹å¼ä¼šé¢‘ç¹çš„åˆ›å»ºã€é”€æ¯ ShortArray å¯¹è±¡ï¼Œèƒ½ä¸èƒ½ä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯¹è±¡æ± æ¥ç®¡ç† ShortArrayï¼Œè¿™æ ·å°±ä¸ä¼šé¢‘ç¹çš„è¿›è¡Œåˆ›å»ºã€é”€æ¯æ“ä½œã€‚åœ¨ Android çš„ support.v4 åŒ…ä¸­æœ‰ä¸€ä¸ª <code>Pools</code> ç±»å®ç°äº†ç®€å•çš„å¯¹è±¡æ± åŠŸèƒ½ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bufferPool = Pools.SynchronizedPool&lt;ShortArray&gt;(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">acquireBuffer</span><span class="params">(bufferSize: <span class="type">Int</span>)</span></span>: ShortArray &#123;</span><br><span class="line">  <span class="keyword">var</span> buffer = bufferPool.acquire()</span><br><span class="line">  <span class="keyword">if</span> (buffer == <span class="literal">null</span> || buffer.size != bufferSize) &#123;</span><br><span class="line">    buffer = ShortArray(bufferSize)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> buffer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">releaseBuffer</span><span class="params">(shortArray: <span class="type">ShortArray</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    bufferPool.release(shortArray)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">    Timber.e(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (isRecording.<span class="keyword">get</span>()) &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡å¯¹è±¡æ± è·å– buffer å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">val</span> buffer = acquireBuffer(bufferSize)</span><br><span class="line">    <span class="comment">// è¯»å–éŸ³é¢‘æ•°æ®åˆ° buffer ä¸­</span></span><br><span class="line">    <span class="keyword">val</span> readSize = audioRecord.read(buffer, <span class="number">0</span>, bufferSize)</span><br><span class="line">    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å°† buffer å‘é€å‡ºå»ï¼Œä¸‹æ¸¸å¤„ç†å®Œæ¯•åè°ƒç”¨ releaseBuffer å¯¹ buffer å¯¹è±¡è¿›è¡Œé‡Šæ”¾</span></span><br><span class="line">      emitter.onNext(buffer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾ˆç®€å•çš„ä¸€ä¸ªå¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è‡ªå·±ä¸èƒ½å¤ç°çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¸¦æ¥äº†å¾ˆå¤§çš„éº»çƒ¦ã€‚<br>è¿™ç§é—®é¢˜åœ¨ç¼–å†™ <code>emitter.onNext(buffer)</code> è¿™è¡Œä»£ç çš„æ—¶å€™å°±åº”è¯¥è¦è€ƒè™‘åˆ°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä¹‹å‰åšç›´æ’­æˆªå±çš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆªå–ç›´æ’­æµçš„ç”»é¢å¸§ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œå› ä¸ºæˆªå±çš„æ“ä½œä¸ä¼šå¾ˆé¢‘ç¹ï¼Œå½“æ—¶æ˜¯ç›´æ¥ copy ä¸€ä»½ç”»é¢å¸§çš„æ•°æ®ä¿å­˜ä¸ºå›¾ç‰‡ã€‚</p>
<p>å¯æ˜¯ä»¥å‰æ²¡æœ‰å†™åšå®¢è®°å½•è¿™ç§å°é—®é¢˜ï¼Œå¯¼è‡´é‡åˆ°ç±»ä¼¼çš„é—®é¢˜å°½é‡ä¸è®°å¾—äº†ã€‚æ‰€ä»¥è¿™æ¬¡è®°å½•ä¸‹æ¥ğŸ˜‚ğŸ˜‚ã€‚</p>
<p><center>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§è„‘å¥½é¥¿</strong>ï¼Œæ›´å¤šå¹²è´§ç­‰ä½ æ¥å°</center><br><img title="å…¬ä¼—å·ï¼šå¤§è„‘å¥½é¥¿" src="http://images.imliujun.com/static/images/wx_qrcode.gif"></p>
</div><iframe src="http://www.imliujun.com/donate-page/simple/" style="overflow-x:hidden;overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.imliujun.com/recording1.html" data-id="ck8ylw0tu000jakw0w0azi4gj" class="article-share-link">åˆ†äº«</a><div class="tags"><a href="/tags/å½•éŸ³/">å½•éŸ³</a><a href="/tags/AudioRecord/">AudioRecord</a></div><div class="post-nav"><a href="/automation1.html" class="pre">æå‡æ•ˆç‡â€”â€”è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ è’²å…¬è‹±</a><a href="/gradle3.html" class="next">ä½¿ç”¨ Gradle å®ç°ä¸€å¥—ä»£ç å¼€å‘å¤šä¸ªåº”ç”¨</a></div><div id="SOHUCS" sid="1521649764000"></div><script>(function(){var appid='cyt4LaybM';var conf='prod_ba6c39a7ee3948f6aafec787e567e6b7';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>')}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})})}})()
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.imliujun.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/è‡ªåŠ¨åŒ–/" style="font-size: 15px;">è‡ªåŠ¨åŒ–</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/è‡ªåŠ¨åŠ å›º/" style="font-size: 15px;">è‡ªåŠ¨åŠ å›º</a> <a href="/tags/å¤šæ¸ é“åŒ…/" style="font-size: 15px;">å¤šæ¸ é“åŒ…</a> <a href="/tags/Android-ç­¾å/" style="font-size: 15px;">Android ç­¾å</a> <a href="/tags/Lottie/" style="font-size: 15px;">Lottie</a> <a href="/tags/ç›´æ’­/" style="font-size: 15px;">ç›´æ’­</a> <a href="/tags/åŠ¨æ€åŠ è½½/" style="font-size: 15px;">åŠ¨æ€åŠ è½½</a> <a href="/tags/ç¤¼ç‰©/" style="font-size: 15px;">ç¤¼ç‰©</a> <a href="/tags/åŠ¨ç”»/" style="font-size: 15px;">åŠ¨ç”»</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/è’²å…¬è‹±/" style="font-size: 15px;">è’²å…¬è‹±</a> <a href="/tags/å½•éŸ³/" style="font-size: 15px;">å½•éŸ³</a> <a href="/tags/AudioRecord/" style="font-size: 15px;">AudioRecord</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/automation3.html">æå‡æ•ˆç‡â€”â€”é…ç½® Jenkins è‡ªåŠ¨åŠ å›ºç­¾åå¤šæ¸ é“åŒ…</a></li><li class="post-list-item"><a class="post-list-link" href="/automation2.html">æå‡æ•ˆç‡â€”â€”è‡ªåŠ¨åŠ å›ºå¹¶ä¸Šä¼ åˆ°è’²å…¬è‹±</a></li><li class="post-list-item"><a class="post-list-link" href="/automation1.html">æå‡æ•ˆç‡â€”â€”è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ è’²å…¬è‹±</a></li><li class="post-list-item"><a class="post-list-link" href="/recording1.html">çº¿ç¨‹å®‰å…¨å¼•èµ·çš„å½•éŸ³æ‚éŸ³ç”µæµéŸ³é—®é¢˜</a></li><li class="post-list-item"><a class="post-list-link" href="/gradle3.html">ä½¿ç”¨ Gradle å®ç°ä¸€å¥—ä»£ç å¼€å‘å¤šä¸ªåº”ç”¨</a></li><li class="post-list-item"><a class="post-list-link" href="/gradle2.html">Android Studio 3.0 ä¸Š Gradle æ”¹åŠ¨</a></li><li class="post-list-item"><a class="post-list-link" href="/gradle1.html">ä½¿ç”¨ Gradle å¯¹åº”ç”¨è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/Lottieåº“å®ç°ç›´æ’­ç¤¼ç‰©åŠ¨ç”».html">Lottie -- è½»æ¾å®ç°åŠ¨æ€åŠ è½½ç›´æ’­ç¤¼ç‰©åŠ¨ç”»</a></li><li class="post-list-item"><a class="post-list-link" href="/hello-world.html">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2020 <a href="/." rel="nofollow">å¤§è„‘å¥½é¥¿.</a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/"> äº¬ICPå¤‡14053652å·-1</a><div></div> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?88a3cbe2051fe51ad73ae8e48687dcbd";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>